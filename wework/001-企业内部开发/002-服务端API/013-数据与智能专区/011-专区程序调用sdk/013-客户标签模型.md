---
title: "客户标签模型"
doc_id: 53350
category_id: 99979
source_url: https://developer.work.weixin.qq.com/document/path/53350
---
[TOC]

应用在专区的程序可调用本接口传入一批会话内容，进行标签匹配。

**详细说明**
> 该接口仅支持分析**文本、语音、音频存档消息**
> 标签组展开后，如果总长度超过了模型的输入限制（大约30000个UTF8字符），任务将失败，返回错误码790040，此时可以尝试减少传入的标签组数量

| 应用类型 | 权限要求 |
| -------- | ---- | 
|自建应用|需具备「!!#ff0000 数据与智能专区权限!!」 |
|代开发应用|需具备「!!#ff0000 数据与智能专区权限!!」|
|第三方应用|需具备「!!#ff0000 数据与智能专区权限!!」|

## 创建标签匹配任务

**请求方法**
通过SDK调用，具体方式参考[专区程序使用指引](#54006)。

**请求接口名：**
create_customer_tag_task

**请求包体：**

```
{
  "tag_group_list": [{
    "group_id": "GROUP_ID1"
  },{
    "group_id": "GROUP_ID2"
  }],
 "msg_list":[{
 "msgid": "MSGID1",
 "encrypt_info":{
 "secret_key": "SECRETKEY1"
 }
 },{
 "msgid": "MSGID2",
 "encrypt_info":{
 "secret_key": "SECRETKEY2"
 }
 }]
}
```

**参数说明：** 

| 参数 | 是否必须 | 说明 |
| ------- | ---- | ---- |
|access_token|是|调用接口凭证|
|tag_group_list|是|客户标签组列表|
|tag_group_list.group_id|是|每个id代表一个[客户标签组](#17298)。|
|msg_list|是|消息列表，最多1000个|
|msg_list.msgid|是|每条消息对应的msgid。多次出现同一个msgid，以首次出现的为准。目前支持文本、语音、音频存档消息|
|msg_list.encrypt_info.secret_key|是|该消息的密钥，将encrypted_secret_key用RSA私钥解密后得到|
|model_id|否|模型id。不指定则使用企微后台默认的大语言模型|

> 注：建议tag_group_id_list中每个标签组内的标签含义互斥，建议msg_list的文本可以表示出单个客户的标签含义

**返回结果：**
```
{
 "errcode": 0,
 "errmsg": "ok",
 "jobid": "JOBID",
 "fail_list":[
 {
 "errcode": 710601,
 "errmsg": "xxx",
 "msgid": "MSGID2",
 "encrypt_info":{
 "secret_key": "SECRETKEY2"
 }
 }
 ]
}
```
**参数说明：**

| 参数 | 说明 |
| ------- | ---- |
| errcode |错误码 |
|errmsg|错误码说明|
|jobid|任务id。首次提交时返回|
|fail_list|提交出错的消息列表，只有msgid重复项返回至该列表，详见**FailMsg说明**|

**FailMsg说明：**

| 参数 | 说明 |
| ------- | ---- |
| errcode |错误码 |
|errmsg|错误码说明|
|msgid|每条消息对应的msgid，与入参对应|
|encrypt_info|每条消息对应的加密信息，与入参对应|
|encrypt_info.secret_key|加密消息用的secret_key|

## 获取标签任务结果

**请求方法**
通过SDK调用，具体方式参考[专区程序使用指引](#54006)。

**请求接口名：**
get_customer_tag_result

**请求包体：**

```
{
 "jobid": "JOBID"
}
```

**参数说明：** 

| 参数 | 是否必须 | 说明 |
| ------- | ---- | ---- |
|jobid| 是 |任务id|

**返回结果：**
```
{
 "errcode": 0,
 "errmsg": "ok",
  "status": 1,
 "fail_list":[{
 "errcode": 710601,
 "errmsg": "xxx",
 "msgid": "MSGID"
 }],
 "tag_result_list": [{
    "group_id": "GROUP_ID1",
    "tag_id": "TAG_ID1"
  },{
    "group_id": "GROUP_ID2",
    "tag_id": "TAG_ID2"
  }]
}
```
**参数说明：**

| 参数 | 说明 |
| ------- | ---- |
| errcode |错误码 |
|errmsg|错误码说明|
|status|任务执行状态<br>0: 执行未完成<br>1: 执行完成<br>2: 执行失败|
|fail_list| 错误的消息列表，如msgid不存在、非文本等，详见“创建标签匹配任务”的**FailMsg说明**|
|tag_result_list| 每个标签组匹配中的标签，如果未匹配中的则不返回，详见**TagResult说明**|

**TagResult说明：**

| 参数 | 说明 |
| ------- | ---- |
| group_id | 客户标签组id |
| tag_id | 命中的标签id |

## 频率限制说明
- 每企业每天不超过1万次（按调用次数限制）
- 若资源紧张，任务重试超过24小时仍未有足够资源执行，任务将失败
