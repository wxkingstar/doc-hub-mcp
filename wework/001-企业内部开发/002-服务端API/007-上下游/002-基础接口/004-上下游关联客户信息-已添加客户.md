---
title: "上下游关联客户信息-已添加客户"
doc_id: 35987
category_id: 95818
source_url: https://developer.work.weixin.qq.com/document/path/95818
---
最后更新：2024/03/11

[TOC]
## 场景
品牌在公众号、小程序上的微信粉丝，可以跟经销商用企微添加的微信客户打通数据
实现效果：共享客户信息，完善客户画像，促进成交

## 准备工作
1. 品牌有自己主体（或isv主体）的公众号、小程序
2. 品牌创建上下游，经销商新建企业并加入上下游
3. 品牌共享应用给经销商
4. 经销商管理员授权应用获取「企业客户」权限

## 思路
**针对经销商已用企微添加的微信客户（当前接口）**
品牌通过以下接口把公众号、小程序粉丝的 unionid （从微信开放平台获取）转换成 external_userid

**针对经销商还未用企微添加的微信客户（[接口链接](https://developer.work.weixin.qq.com/document/path/97357)）**
1. 品牌提前把公众号、小程序粉丝的 unionid （从微信开放平台获取）转换成 pending_id
2. 经销商用企微添加微信客户时，用 external_userid 查询 pending_id
3. unionid 和 external_userid 数据打通

---

### external_userid的说明
external_userid是企业微信用于表示企业的外部联系人而设立的id，且满足以下条件
假设同一个微信用户属于多个下游企业的外部联系人
1.同一上游企业获取到不同企业的外部联系人的external_userid不一致。
2.不同一上游企业获取同一个企业的同一个外部联系人的external_userid也不一致。

### 通过unionid和openid查询external_userid

**请求方式：**POST（**HTTPS**）
**请求地址**：https://qyapi.weixin.qq.com/cgi-bin/corpgroup/unionid_to_external_userid?access_token=ACCESS_TOKEN

**请求参数：**
```
{
 "unionid":"xxxxx",
 "openid":"xxxxx",
 "corpid":"xxxxx",
 "mass_call_ticket":"xxxxx"
}
```

**参数说明：**

| 参数 | 必须 | 说明 |
| :----------- | :--- | :----------------- |
| access_token | 是 | 上游应用的access_token |
|unionid|是|微信客户的unionid|
| openid | 是 |微信客户的openid|
| corpid | 否 | 需要换取的企业corpid，不填则拉取所有企业 |
| mass_call_ticket | 否 | [大批量调用凭据](#41709/获取接口高频调用凭据), 适用于数据初始化场景, 有获取及使用限制 |

**权限说明：**
> 调用该接口的应用必须是上下游共享的应用
> 上游企业须已认证
> unionid（unionid的主体为绑定了该小程序的微信开放平台账号主体）和openid（即小程序账号主体）的主体需与当前企业的主体一致
> openid与unionid必须是在同一个小程序获取到的
> 应用需要具有客户联系权限
> 自建应用/代开发应用可调用，第三方应用请查看[企业客户微信unionid的升级方案](#35863/四、企业客户微信unionid的升级方案)
> 调用频率最大为10万次/小时，48万次/天，750万次/月; 传入[有效mass_call_ticket](#41709)，可不受此限制, 但是依然受到[基础频率限制](#10785)。

**返回结果：**

```
｛
 "errcode":0,
 "errmsg":"ok",
 "external_userid_info":[
     {
      "corpid":"AAAAA", 
      "external_userid":"BBBB"
    }, 
    {
      "corpid":"CCCCC", 
      "external_userid":"DDDDD"
    }
  ]
｝
```
**参数说明：**

| 参数 | 说明 |
| :----------- | :----------------- |
| errcode | 返回码 |
| errmsg | 对返回码的文本描述内容 |
| external_userid_info | 该unionid对应的外部联系人信息 |
| external_userid_info.corpid | 所属企业id |
| external_userid_info.external_userid | 外部联系人id |
