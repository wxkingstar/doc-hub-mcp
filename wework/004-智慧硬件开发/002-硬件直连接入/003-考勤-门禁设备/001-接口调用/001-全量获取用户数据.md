---
title: "全量获取用户数据"
doc_id: 15356
category_id: 93983
source_url: https://developer.work.weixin.qq.com/document/path/93983
---
最后更新：2022/09/16

设备每次登录成功之后，需要比对本地通讯录版本号和云端最大的版本号，如果不一致则设备需要主动调用该接口。
本接口为分页接口，每页数据返回时会同时返回当前云端的最大版本号，如果同步到最后一页的过程中版本号有变化则需要重新开始同步。

**请求包体：**

```
{
 "cmd":"get_userinfo_by_page",
 "headers":
  {
    "req_id":"xxxxx"
  },
  "body":
  {
     "offset":0,
    "limit":10,
    "is_req_fp_info":1,
    "is_req_fa_info":1,
    "is_req_public_key":1
  }
}
```

**参数说明：**
 
| 参数名 | 是否必须 | 类型 | 描述 |
| ------ | ---- | ------ | -------------------- |
| req_id | 是 | string | 请求的id，自行保证不会重复即可 |
| offset | 是 | Uint32 | 偏移量(范围是该机器设置的考勤人员列表) |
| limit | 是 | Uint32 | 本次同步的人数(最高200) |
| is_req_fp_info | 否 | Uint32 | 默认1, 0:不返回fp数据列表, 1:才返回 |
| is_req_fa_info | 否 | Uint32 | 默认1, 0:不返回fa数据列表, 1:才返回 |
| is_req_public_key | 否 | Uint32 | 默认0, 0:不返回, 1:才返回 |
**返回结果：** 

```
{
  "headers": 
  {
     "req_id" : "xxxx"
  },
  "body": 
  {
    "is_last": false, 
    "perm_version": 5, 
    "userinfo":
    [
    {
      "userid":"x1",
      "openvid":123456,
      "user_type":0,
      "fp_ver":1,
      "fa_ver":1,
      "public_key": "AmOVOOcprQJXEi94HPv9S",
      "pass_rule_list": [
        {
          "id":0, 
          "rule":"9:00-10:00 * * 1-5 *",
          "effect_time":1542874137
        },
        {
          "id":1, 
          "rule":"9:30-10:00 * * 6 *",
          "effect_time":1542874137
        }
      ],
      "name":"张三",
      "fp":[
        {
          "id":0,
          "data":"xxxx"
        },
        {
          "id":1,
          "data":"xxxx"
        }
      ],
      "fa_list":[
        {
          "id":0,
          "data":"xxxx"
        },
        {
          "id":1,
          "data":"xxxx"
        }
      ]
    },
    {
      "userid":"x2",
      "openvid":1234567,
      "user_type":0,
      "fp_ver":1,
      "fa_ver":1,
      "public_key": "AmOVOOcprQJXEi94HPv9S",
      "pass_rule_list": [
        {
          "id":0, 
          "rule":"9:00-10:00 * * 1-5 *",
          "effect_time":1542874137
        },
        {
          "id":1, 
          "rule":"9:30-10:00 * * 6 *",
          "effect_time":1542874137
        }
      ],
      "name":"李四",
      "fa":"xxxx"
    },
    {
      "userid":"x3",
      "openvid":12345678,
      "user_type":0,
      "fp_ver":1,
      "fa_ver":1,
      "public_key": "AmOVOOcprQJXEi94HPv9S",
      "pass_rule_list": [
        {
          "id":0, 
          "rule":"9:00-10:00 * * 1-5 *",
          "effect_time":1542874137
        },
        {
          "id":1, 
          "rule":"9:30-10:00 * * 6 *",
          "effect_time":1542874137
        }
      ],
      "name":"王五",
      "fa":"xxxx"
    }
    ]
  },
  "errcode": 0,
  "errmsg": "ok"
}
```

**参数说明：** 

| 参数名 | 描述 |
| -------------- | ------------------------------------ |
| req_id | 透传请求的req_id |
| errcode | 错误码 |
| errmsg | 错误码描述 |
| is_last | true/false 表示是否最后一页数据 |
| userid | 成员id（字符串），长度为1-64个字节。 |
| openvid | 成员id（uint64）， 可用于二维码签名校验。注意：成员一定要用userid作为主键，openvid仅用于部分接口的签名计算，大部分接口不支持openvid作为参数|
| user_type | 成员的类型： 0：企业员工 1：访客 2：学生 不填则默认值为0 |
| fp_ver | 指纹版本号 |
| fa_ver | 人脸版本号 |
| public_key | 离线二维码签名校验的公钥 |
| pass_rule_list | 放行规则列表，id为编号，rule为具体规则，其解析语法请参考附录[门禁放行规则语法说明](#15400) |
| effect_time | 规则生效时间 |
| fp | 成员指纹信息(base64), id,data数据同[上传用户数据](#15355) |
| fa | 成员脸部识别信息(base64) ,2020年1月10日后登记的机型将不再返回该字段 |
| fa_list | 成员脸部识别信息(base64),id,data数据同[上传用户数据](#15355) |
| name | 成员姓名，长度为1-64个utf8字符 |
| perm_version | 当前云端通讯录版本号 |
>注：成员没有放行规则或者放行规则为空时，建议默认行为是员工通行，访客不可通行。
