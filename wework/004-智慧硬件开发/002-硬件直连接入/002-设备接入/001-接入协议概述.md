---
title: "接入协议概述"
doc_id: 15349
category_id: 91366
source_url: https://developer.work.weixin.qq.com/document/path/15349
---
[TOC]

##概要
当企业启用硬件设备之后，设备可连接企业微信云端，调用相关接口，让设备提供的能力与企业通讯录结合，以实现更加完美的办公体验。目前支持接入的设备有考勤机、门禁、打印机等。

##通讯协议
设备与企业微信云端采用wss(WebSocket Secure)长连接协议。企业微信云端地址为：wss://openhw.work.weixin.qq.com/

##设备联网流程
- ![](http://p.qpic.cn/pic_wework/4166291057/7b7d70766afa01f37ad8e2085a638fa2b75f9a038d33d192/0)
1. 设备开机联网
2. 与企业微信云端建立长连接（地址为：wss://openhw.work.weixin.qq.com/）
3. 注册网络
4. 激活设备（已激活的设备直接跳过该步骤，待激活的设备一直轮询等待企业管理员关联绑定设备）
5. 订阅企业信息
6. 订阅之后，设备方可调用企业微信云端的[获取固件最新信息](#15367)等，并可同时接收企业微信云端下发的指令，例如[设备绑定企业完成事件](#15376)。

##企业绑定设备时的匹配方式

### 匹配方式的选择
企业在使用设备之前，需要完成匹配绑定，厂商可为设备选择合适的匹配方式，目前有：输入SN、企业微信扫码（动态二维码与静态二维码）和蓝牙发现等几种方式。输入SN较为简单，不过安全级别相对较低。以下分别说明蓝牙发现、动态二维码、静态二维码三种方式。
- ![](https://wework.qpic.cn/wwpic/849773_OFuNXVYHTF2ESE2_1601292566/0)

### 蓝牙发现
如果设备有蓝牙模块，可以使用蓝牙匹配方式进行绑定，我们开放了一套对接协议，设备对接之后，企业管理员可在手机端企业微信工作台进入蓝牙发现设备的界面完成设备的查找与绑定。具体协议参见：[蓝牙识别及配网协议](#14078)

上述的协议支持通过企业微信给设备配置wifi网络。用户在发现蓝牙设备之后，如果设备未连网，可让用户先完成配网，之后再进行绑定。设备也可以直接给用户展示以下二维码，用户扫码之后即进行蓝牙发现与配网的流程。
- ![](https://wework.qpic.cn/wwpic/654208_5-R9uVl5R3SpNxM_1601294848/0)
该二维码的数据内容实际为一个url: https://open.work.weixin.qq.com/hw/f?t=bt
你也可以在设备屏幕上用该url生成二维码。

### 动态绑定二维码
硬件设备显示屏上需要显示一个动态二维码，二维码是由一个url生成，url格式如：<br/>```https://open.work.weixin.qq.com/connect/hardware?sn=xxxxx&timestamp=1500133456&nonce=1234&signature=fdsaoiurewkjjaaa&type=qrcode```

**参数说明**：

| 参数名 | 是否必须 | 类型 | 描述 |
| --- | --- | --- | --- |
| sn | 是 | String | 设备序列号 |
| timestamp | 是 | Uint32 | UTC时间戳，需要每30分钟变更1次（建议10分钟刷新1次），企业微信会检查该时间戳是否在30分钟有效期内，过期会报二维码失效。 |
| nonce | 是 | Uint64 | 随机数 |
| signature | 是 | String(40) | 设备签名，sha1(sort(sn、SecretNo、timestamp、nonce、type))。sort的含义是将参数值按照字母字典排序，然后从小到大拼接成一个字符串。SecretNo是由企业微信为每个设备生成的密钥，供应商可将其固化到设备上。 |
| type | 是 | String | 此处固定为qrcode |

### 静态绑定二维码
若设备仅支持低安全级别，可以展示或者粘贴固定二维码，二维码内容为一个url。在企业微信服务商管理端登记设备后，导出的excel文件中包含该静态二维码url（需要以该url作为数据内容生成二维码）
url格式如：
<br/>```https://open.work.weixin.qq.com/connect/hardware?hw_code=xxxx```
