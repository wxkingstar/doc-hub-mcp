---
title: "聊天工具栏接口"
doc_id: 38713
category_id: 95827
source_url: https://developer.work.weixin.qq.com/document/path/38713
---
[TOC]

## 概述

企业可将应用页面配置到上下游聊天工具栏，方便接待人员在与上下游联系人的聊天中查看和使用，提高服务效率。从工具栏打开的页面，除了一般的小程序接口之外，可以使用有会话属性的接口，例如：获取当前联系人userid、分享消息到当前会话。当然，开发者首先需要调用getContext接口获取当前入口entry值，以此判断是否从上下游工具栏进入页面。

## 接口说明

### getContext

接口使用说明详见“[wx.qy.getContext](#21951)”，在上下游聊天工具栏里返回的entry值是chain_single_chat_tools或chain_group_chat_tools，具体如下：

返回结果 **entry** 说明

| 值 | 说明 | 支持的最低版本 |
| -------- | ---- | ----- |
| contact_profile | 从联系人详情进入 | 3.0.24 |
| single_chat_tools | 从单聊会话的工具栏进入 |3.0.24 |
| group_chat_tools | 从群聊会话的工具栏进入 | 3.0.24 |
| chat_attachment | 从会话的聊天附件栏进入 | 3.1.6 |
| single_kf_tools | 从微信客服的工具栏进入 | 3.1.10 |
| **chain_single_chat_tools** | **从上下游单聊会话的工具栏进入** |4.0.8 |
| **chain_group_chat_tools** |**从上下游群聊会话的工具栏进入**| 4.0.8 |
| normal | 除以上场景之外进入，例如工作台，聊天会话等 | 3.0.24 |

### 获取当前上下游联系人userid

>**调用前提：**
> 此接口仅在企业微信4.0.8及以后版本支持，微信端不支持（微信开发者工具也不支持），仅支持ios，android和PC端调用
> 必须先调用过wx.qy.login，且session_key未过期，开发者可调用checkSession 检查当前登录态
> 当前成员必须在应用的可见范围。
> 需要从上下游会话的工具栏进入页面才可调用，否则会报错：“only support chain group chat tools entry”，可先通过调用[wx.qy.getContext](#21951)来判断进入小程序的入口。

| 入口 | getContext的entry值 | 自建应用 |第三方应用 | 用户 | 支持的最低版本 |
| ------- | ----- | -------------------- | ------------ |------------ |----- |
| 上下游单聊会话的工具栏 | chain_single_chat_tools | 所有 | 所有 | 所有 |4.0.8|

**参数**
**Object object**

| 参数名 | 类型 | 必填 | 说明 |
| ---------- | -------- | ---- | ---------------------------------------- |
| success | Function | 否 | 接口调用成功的回调函数 |
| fail | Function | 否 | 接口调用失败的回调函数 |
| complete | Function | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

**object.success 回调函数**
**参数**

**Object res**

| 参数 | 类型 | 说明 |
| ------- | ----- | -------------------- |
| corpId | String | 返回当前上下游联系人所在的企业corpId |
| userId | String | 返回当前上下游联系人的userId |

**示例代码：**

```js

wx.qy.getCurCorpGroupContact ({
 success: function(res) {
 var corpId = res.corpId; // 返回当前联系人的企业corpId
 var userId = res.userId //返回当前联系人userId
 }
})

```

### 获取当前上下游互联群的群ID

>**调用前提：**
> 此接口仅在企业微信4.0.12及以后版本支持，微信端不支持（微信开发者工具也不支持），仅支持ios，android和PC端调用
> 必须先调用过wx.qy.login，且session_key未过期，开发者可调用checkSession 检查当前登录态
> 当前成员必须在应用的可见范围。
> 需要从上下游会话的工具栏进入页面才可调用，否则会报错：without context of corpgroup contact，可先通过调用[wx.qy.getContext](#21951)来判断进入小程序的入口。

| 入口 | getContext的entry值 | 自建应用 |第三方应用 | 用户 | 支持的最低版本 |
| ------- | ----- | -------------------- | ------------ |------------ |----- |
| 上下游群聊会话的工具栏 | chain_group_chat_tools | 所有 | 所有 | 所有 |4.0.12|

**参数**
**Object object**

| 参数名 | 类型 | 必填 | 说明 |
| ---------- | -------- | ---- | ---------------------------------------- |
| success | Function | 否 | 接口调用成功的回调函数 |
| fail | Function | 否 | 接口调用失败的回调函数 |
| complete | Function | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

**object.success 回调函数**
**参数**

**Object res**

| 参数 | 类型 | 说明 |
| ------- | ----- | -------------------- |
| chatId | String | 返回当前互联群的群聊ID |

**示例代码：**

```js

wx.qy.getCurCorpGroupChat ({
 success: function(res) {
 chatId = res.chatId ; //返回当前互联群的群聊ID
 }
})

```

### 分享消息到当前会话

接口使用说明详见“[wx.qy.sendChatMessage](#21264)”，可在上下游的聊天工具栏里可调用该接口，调用前可先通过调用[wx.qy.getContext](#21951)来判断进入小程序的入口。

| 入口 | getContext的entry值 | 自建应用 |第三方应用 | 用户 | 支持的最低版本 |
| ------- | ----- | -------------------- | ------------ |------------ |----- |
| 上下游单聊会话的工具栏 | chain_single_chat_tools | 所有 | 所有 | 所有 |4.0.8|
| 上下游群聊会话的工具栏 | chain_group_chat_tools | 所有 | 所有 | 所有 |4.0.8|
