---
title: "会话消息搜索"
doc_id: 43533
category_id: 97374
source_url: https://developer.work.weixin.qq.com/document/path/97374
---
最后更新：2024/07/12

服务商可调用接口对企业会话的内容进行搜索
**权限说明**

> 仅支持对部分消息内容进行搜索，包括：
> **文本消息**的消息内容
> **图文混合消息**中的文本内容
> **文件消息**的文件名称
> **链接消息**的消息标题
> **小程序消息**的消息标题
> **在线文档消息**的文档名称
> **微盘文件消息**的文件名称

| 应用类型 | 权限要求 |
| -------- | ---- | 
|自建应用|暂不支持 |
|代开发应用|暂不支持|
|第三方应用|暂不支持|
|会话存档接口授权|需具备「!!#ff0000 会话存档接口权限- 获取会话记录!!」权限|

**请求方式：** POST（**HTTPS**）
**请求地址：** https://qyapi.weixin.qq.com/cgi-bin/chatdata/search_msg?access_token=ACCESS_TOKEN

**请求包体：**

```

  "query_word": "欢迎",
  "chat_info": {
    "chat_type": 1,
    "id_list": [ {
        "open_userid": "OPEN_USERID"
      }, {
        "external_userid": "EXTERNALID1"
      }
    ],
    //"chat_id : "CHATID"
  },
  "start_time":1668355200,
  "end_time":1668528000,
  "limit": 50,
  "cursor": "CURSOR"

```

**参数说明：** 

| 参数 | 是否必须 | 说明 |
| ------- | ---- | ---- |
|access_token|是|调用接口凭证|
|query_word|是|搜索的文本，要求大于等于2个UTF8字符。|
|chat_info|否|指定要搜索的会话范围|
|chat_info.chat_type|否|指定会话类型，若填写则从指定的会话类型中搜索。</br> 1：单聊；2：群聊|
|chat_info.id_list|否|chat_type为**单聊**时有效，会话双方的id，该列表长度必须为2，详见**IdInfo**|
|chat_info.chat_id|否|chat_type为**群聊**时有效，若填写则从指定的群聊会话id中搜索|
|start_time|否|指定搜索会话范围的起始时间，Unix时间戳|
|end_time|否|指定搜索会话范围的结束时间，Unix时间戳。若指定了end_time，也必须指定start_time，start_time必须小于end_time，且时间范围不超过30天整；若都不指定则默认时间范围为当前时刻往前30天内。|
|limit|否|用于分页查询，每次请求返回的数据上限。最大为100，不填默认为50|
|cursor|否|用于分页查询的游标，字符串类型，由上一次调用返回，首次调用可不填|
**IdInfo说明：** 
| 参数 | 是否必须 | 说明 |
| ------- | ---- | ---- |
|open_userid|否| 成员ID。会话者的身份类型为企业成员时填，优先识别该字段|
|external_userid|否| 客户ID。会话者的身份类型为为客户时填|

**返回结果：**
```
{
  "errcode": 0,
  "errmsg": "ok",
  "has_more": 1,
  "next_cursor": "CURSOR",
  "msg_list":[
    {
      "msgid": "xxxmsgid"
    },
    {
      "msgid": "yyymsgid"
    }
  ]
}
```
**参数说明：**

| 参数 | 说明 |
| ------- | ---- |
| errcode |错误码 |
|errmsg|错误码说明|
|has_more|是否还有更多数据未获取，不填默认为0<br>0: 否<br>1: 是|
|next_cursor|下一次请求的cursor值|
|msg_list|搜索结果的消息列表，按消息发送时间降序排序|
|msgid|每条消息对应的msgid|
