---
title: "常见问题"
doc_id: 55301
category_id: 100252
source_url: https://developer.work.weixin.qq.com/document/path/55301
---
[TOC]
# 数据专区授权
- 企业能否同时授权服务商数据专区和自己内部购买使用会话存档？
**答：**可以的。在企业侧数据专区和会话存档是两个功能，无直接关系。

- 企业授权服务商数据专区时，需要企业在会话存档页上传确认函吗？
**答：**不需要。企业只需要在企业管理后台「安全与管理-管理工具-数据与智能专区-会话数据」中上传确认函开启会话数据即可，不需要在会话存档页面进行操作。

- 同一个企业的数据专区权限是否可以授权给多个服务商的多个应用？
**答：**可以的，数据专区权限的授权不同服务商并无限制。

- 企业授权的会话内容存储时长是否可以修改，比如一开始授权的是 90 天，后续是否可修改为 2 年？
**答：**企业可以修改。

# 接口付费购买
- 会话数据接口的版本如何同服务商应用的版本进行关联？
**答：**两者不存在直接关联关系。会话数据接口分为服务版（企业内外部会话）和企业版（企业内外部会话及语音通话），服务商按照在企业下应用使用到的接口购买对应的版本。而服务商应用版本是按照应用提供的功能去区分对应的版本，和会话数据接口版本无直接关联关系。

- 企业安装三方应用后，选择购买了应用的某个版本，企业支付完成后会自动购买会话数据接口的版本吗（这是怎么对应的）？还是需要服务商手动操作？
**答：**应用版本是企业向服务商购买，而会话数据接口是服务商向企业微信购买。如果服务商应用需要使用会话数据接口，则在企业购买应用版本后，服务商应及时在「桌面端服务商助手-工具-通用配置-高级接口」中进行购买。

- 数据专区的会话数据接口是否支持通过 API 进行购买？
**答：**目前不支持，需要服务商手动在「桌面端服务商助手-工具-通用配置-高级接口」中进行购买，后续考虑支持（支持后会对外同步）。

- 数据专区的会话数据接口是否支持只有外部会话的版本？
**答：**不支持。目前只支持服务版（企业内外部会话）和企业版（企业内外部会话及语音通话）。

- 服务商购买的数据接口和使用人员如何绑定？
**答：**绑定是自动绑定的。当服务商购买的数据接口账号大于等于使用人员时，可直接使用接口不受影响。当使用人员超出购买账号时，会从使用人员随机取与购买账号数相等的人员使用，其他人员将不可使用。

- 购买会话内容数据接口可以更换使用人员吗？是否有限制？
**答：**可以更换，只要总的使用人员数不超过购买账号数即可。

- 一个企业安装同一个服务商的多个应用，购买的会话内容数据接口可以在多个应用中试用吗？
**答：**会话内容数据接口是服务商维度的，同一服务商的多个应用都可使用，使用时只要多个应用合并去重的人数不超过购买的接口账号数即可。

- 一个企业使用多个服务商的数据专区的应用，是否每个服务商都需要购买会话内容数据接口？
**答：**是的，各个服务商单独购买，彼此之间互不影响。

- 数据专区中企业微信提供的部署程序/模型的机器资源，以及企业微信的分析模型，收费计划是怎样？
**答：**数据专区中的机器资源以及企业微信的分析模型目前都是限时免费，服务商可直接使用。若后续有调整，会提前对外通知。

- 应用仅实现会话存档相关的功能，是否还需要再购买基础接口许可和互通接口许可？
**答：**需要购买基础接口许可，给使用应用的企业员工购买即可。是否购买互通接口许可，看应用是否需要调用客户联系的接口，如果仅仅是页面需要展示客户/客户群名称则不需要调用客户联系接口，因为当前会话展示组件和会话内容导出已支持自动展示客户名称、客户群名称。

# 会话存档接口迁移
- 原本用企业内部自建应用方式实现的会话存档必须要迁移到数据专区吗？
**答：**如果是企业自己实现的或第三方帮企业私有化部署实现的，不受影响，不需要迁移到数据专区。

- 服务商的已购买会话存档企业接口的企业，迁移到数据专区后，原有的会话存档企业接口还能使用吗？
**答：**迁移后，企业还能继续使用会话存档企业接口。对于服务商，在到期时间后，不可继续使用。其中新付费企业的到期时间是2024年10月31日 24:00，历史付费企业的到期时间2024年12月31日 24:00。

- 服务商的已购买会话存档企业接口的企业，迁移到数据专区后，服务商需要重新付费购买数据专区接口吗？
**答：**迁移后，在企业当前有效订单（2024年10月31日及之前已购买且未过期的订单）时间内，服务商可免费使用数据专区的会话数据接口，免费使用到期后服务商需要购买专区会话数据接口。

- 对于历史付费企业，12月31日后是一刀切还是历史付费企业可以用到合同到期？
**答：**对于历史付费企业，12月31日后服务商不可调用企业的会话存档接口，企业调用不受影响。

- 原会话存档的客户，迁移到数据专区，是否还需要重新上传确认函走一遍流程？
**答：**会简化流程以降低迁移门槛，具体迁移工具还在开发中，上线后会同步对应的流程及细节。

- 从会话存档接口迁移到数据专区后，原来通过会话存档接口获取的会话内容，专区有存储吗？
**答：**专区无存储。专区仅存储迁移后产生的一段时间内的会话内容，迁移前的会话内容由服务商自行存储。

# 开发接入
## 专区使用问题
- 上传一个程序到专区，是必须的吗？
**答：**是必须的，要实现数据专区相关的功能，需要根据专区SDK开发一个程序，将镜像上传部署到专区。企业微信目前提供了python、c++、java三个语言的程序示例，开发者可以在此基础上进行开发，详情参见[专区程序示例](#54166)。

- 服务商在数据专区上传程序并提交审核后，能看到程序审核的状态吗？
**答：**程序审核一般需要 1-2 个工作日，审核结果会展示在数据专区中，也会通过服务商助手推送给提交审核的人员。若有特殊情况需要加急审核，也可联系「合作伙伴产品客服」。

- 如果我们不做额外的开发扩展，文档中提供的镜像是否可以直接部署到正式使用？
**答：**示例程序镜像实现了基础SDK接口的调用，如果开发者没有更多的逻辑扩展，可以直接部署使用，建议结合业务实际情况做测试和评估。

- 专区内的sdk也获取不了会话存档消息的明文数据，怎么能自研模型分析？
**答：**在专区内的程序通过sdk调用自研模型，传入的msgid与秘钥会被替换为消息原文，详见：[自有模型分析](#53352)。

- 专区程序有异常了，会自动重新运行吗？有异常开发者是无感的吗？
**答：**目前开发者可以通过[应用同步调用专区程序](#53295)进行拨测，后续企业微信提供重启专区程序的接口。

- 在专区使用上，相比原来而言，性能是否有所下降？
**答：**性能上会有所下降，但企业数据的安全性得到了提升。

- 专区内如有多个程序是否可以相互通信？ 
**答：**多个程序之间目前只能通过[异步调用自有分析程序](#53659)来互调。

- 专区内是否可以支持数据库存储？
**答：**目前暂无计划提供数据库存储。专区内的磁盘也仅用于临时存储的用途，不支持永久性的存储需求。

- 给应用授权数据与智能专区权限后，为何获取不到会话记录？
**答：**数据与智能专区中的每条消息都需要加密，而加密需要用到应用设置的公钥，所以只有设置了公钥之后，才能进行存档。

- 可以获取多长时间的会话记录？
**答：**5天。注意：消息密文的保存时长是由企业的选择决定，默认是90天，最长可以2年.在保存时长内，根据消息message-id与secret-key可以在会话展示组件中展示，也可以在专区中分析。但是，不包含消息密文的会话记录，在企业微信专区内只保存5天，应用需要及时拉取，参见[获取会话记录](#53341)。

- 如何按照成员、发送时间等条件查询会话记录？
**答：**通过[获取会话记录](#53341)SDK接口所获取的记录中，包含每条消息的发送者、接收者、发送时间、消息类型等，应用可以按这些信息进行查询。

- 为什么收不到“产生会话回调通知”？
**答：**可能有以下原因：
  - 成员不在使用范围内 
  - 未设置公钥 
  - 试用期过期或者购买已过期
  - 应用还没有开启数据专区权限 

- 企业取消授权后再重新授权，需要设置公钥吗？
**答：**需要，重新授权后需要处理的步骤和新授权是一样的，也要[设置公钥](#51799)和[设置专区接收回调事件](#53411)。

- 企业授权和取消授权数据与智能专区权限，或者授权人员范围变更，能不能有回调通知？
**答：**数据与智能专区的会话数据授权变更，包括授权会话类型变更、授权的人员范围变更、授权的会话时长变更，会回调[变更授权通知](#14951/变更授权通知)事件，应用可以再调用[获取应用权限详情](#48334)和[获取数据与智能专区授权信息](#55567)进行授权内容变更比对。

- 如何实现批量获取专区程序收到的回调通知？
**答：**专区程序部署在多机，每台机器各自接收到部分回调通知，但都不完整，故目前没办法一次性获取到完整的回调通知。专区程序可先对接收到的回调事件聚合存储，当应用后台接收到专区程序的通知时，根据本次收到的notify_id，可以批量获取到该机中已聚合过的回调通知事件（注意：此时其他机器的回调通知尚未获取到，需等待另一台机器的notify_id才能获取）。

- 如何删除专区程序中的临时文件？
**答：**专区程序接收到回调通知事件后，采用文件进行临时存储，建议由专区中的程序自行定期删除。示例程序中采用线程定时轮询删除的逻辑，开发者也可使用crontab等实现定期删除的机制。

- 调试模式下的程序，也需要上传镜像并通过审核吗？
**答：**不需要，但只允许测试企业可以使用未上线的程序以及使用调试模式。

- request_data格式不匹配，是什么原因？
**答：**注意如下规范：
  - 对于Python示例程序，其request_data内还需要包裹一层input对象
  - 对于Java和C++示例程序，request_data和response_data内即为输入输出的键值对，没有包裹对象
  - 详见：[应用同步调用专区程序](#53295)

- 获取的会话记录中如何区分哪些是撤回的消息？
**答：**已撤回的消息在会话展示组件中会有明显标识，以表现出消息已被撤回。如果需要监控“撤回消息”的行为，可以通过配置关键词规则，指定semantics即可实现，参见[关键词规则管理](#53346)。

## 专区环境问题

- 专区镜像支持哪些操作系统？
**答：**目前仅支持linux。

- 专区SDK支持哪些编程语言？
**答：**目前仅支持python、c++、java。

- 示例程序镜像打包用的是什么linux jdk环境，为什么打包的大小比示例的要小很多？
**答：**打包的镜像文件大小跟基础镜像选择以及工具安装有关，用`docker export`来打包导出镜像即可，参考：[镜像文件配置指引](#53065)。

- Java程序镜像使用过程中出现中文乱码，如何解决？
**答：**企业微信所有数据采用的字符集均为UTF-8，而JVM启动时默认读取系统的字符集作为String类型的字符集，在初始化String进行数据传输时会默认按照该类型解码。开发者可以：
  - 添加java启动参数-Dfile.encoding=UTF-8，指定JVM默认字符集。
  - 在程序内保证socket的读写均按照UTF-8解码编码。

- Java程序调用失败，会是什么原因？
**答：**可以参考如下指示进行排查：
  - Java程序的动态链接库路径错误
```java
UnsastifiedLinkError + no libxxx.so in java.library.path 
```
  - Java程序的SDK没有放在包com.tencent.wework下
```java
UnsastifiedLinkError + no implementation found for xxxfunction
```

## 专区监控/日志问题
- 怎么监控专区程序的运行情况？比如JVM，线程等。容器程序突然不工作了 。
**答：**在管理后台「数据与智能专区 - 调用统计」可查看程序/模型的调用统计和运行监控。容器内程序运行的情况，目前可以结合[日志查询](#54006/专区程序的日志打印)来排查。

- Java版本的日志是否支持SLF4J？
**答：**不支持，可根据需要封装日志接口`SpecUtil.SpecLogNative`

::: tip 提示
仅日志接口输出的日志能被平台收集，详见：[日志查询](#54006/专区程序的日志打印)
:::

- 正式环境下，应用没有接收到专区程序回调到应用的信息，这种情况下可以怎么排查问题？
**答：**在专区程序中可以在关键位置添加日志，然后在管理端「数据与智能专区 - 日志查询」中搜索日志。

## 展示组件使用问题
- 原本能够展示的消息突然无法显示？
**答：**可能的原因如下：
  - 企业取消授权后重新授权，重新授权前的消息无法展示 
  - 试用期过期或者购买已过期

- 离职员工或已删好友的消息，在展示组件中是否支持展示？
**答：**支持，有message-id、secret-key即可。

- 通过企业内[会话内容存档](#15329)获取的会话记录，是否支持在展示组件中展示？
**答：**不支持展示，应用可以将两者分别展示，企业内[会话内容存档](#15329)直接展示，数据专区中获取的会话记录则用展示组件进行展示。

- 代开发应用获取的会话记录中的群id，在展示组件为什么无法展示群名称？
**答：**代开发应用需要先将群id进行升级，才能在[展示组件](#50920)正常展示。详见：[群ID的升级转换](#52106)。
