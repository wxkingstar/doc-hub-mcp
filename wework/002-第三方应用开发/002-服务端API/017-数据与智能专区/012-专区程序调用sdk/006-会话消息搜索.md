---
title: "会话消息搜索"
doc_id: 53335
category_id: 99818
source_url: https://developer.work.weixin.qq.com/document/path/53335
---
可调用该接口对企业会话的内容进行搜索
**权限说明**

| 应用类型 | 权限要求 |
| -------- | ---- | 
|自建应用|需具备「!!#ff0000 数据与智能专区权限!!」 |
|代开发应用|需具备「!!#ff0000 数据与智能专区权限!!」|
|第三方应用|需具备「!!#ff0000 数据与智能专区权限!!」|

**支持搜索的消息**
仅支持对部分消息内容进行搜索，包括：
| 消息类型 |可搜字段说明|msg_type|
| -------- | ---- | ---- | 
|文本消息 |消息内容|1|
|链接消息 |消息标题|4|
|小程序消息 |消息标题|5|
|文件消息 |文件名称|8|
|在线文档消息 |文档名称|18|
|图文混合消息 |文本内容|20|
|微盘文件消息 |文件名称|23|

**请求方法**
通过SDK调用，具体方式参考[专区程序使用指引](#54006)。

**接口名：**
search_msg

**请求包体：**

```
{
  "query_word": "欢迎",
  "chat_info": {
    "chat_type": 1,
    "id_list": [ {
        "open_userid": "OPEN_USERID"
      }, {
        "external_userid": "EXTERNALID1"
      }
    ],
    "chat_id": "CHAT_ID",
    "msg_type_list":[1],
    "sender": {
      "open_userid": "OPEN_USERID"
    },
    "sender_list": [
      {
        "open_userid":"OPEN_USERID"
      }
    ]
  },
  "start_time": 1668355200,
  "end_time": 1668528000,
  "skip_stop_words": true,
  "limit": 50,
  "cursor": "CURSOR"
}
```

**参数说明：** 

| 参数 | 是否必须 | 说明 |
| ------- | ---- | ---- |
|query_word|是|搜索的关键词，要求大于等于2个UTF8字符。|
|chat_info|否|指定要搜索的客户会话范围|
|chat_info.chat_type|否|指定会话类型，若填写则从指定的会话类型中搜索。</br> 1：单聊；2：群聊|
|chat_info.id_list|否|chat_type为**单聊**时有效，会话双方的id，该列表长度必须为2，详见**IdInfo**|
|chat_info.chat_id|否|chat_type为**群聊**时有效，若填写则从指定的群聊会话id中搜索|
|chat_info.msg_type_list|否|指定搜索的消息类型，仅支持可搜索的消息类型。如果不填则默认搜索所有可搜的消息类型|
|chat_info.sender|否|指定消息的发送者，详见**IdInfo** <br> 目前仅支持企业内员工|
|chat_info.sender_list|否|指定消息的发送者列表，会搜索发送者为其中之一的消息，详见**IdInfo** <br> 目前仅支持企业内员工<br>最多传入100个IdInfo<br>**指定了此字段时，sender字段的内容将被忽略**|
|start_time|否|指定搜索会话范围的起始时间，Unix时间戳|
|end_time|否|指定搜索会话范围的结束时间，Unix时间戳。若指定了end_time，也必须指定start_time，start_time必须小于end_time，且时间范围不超过31天整；若都不指定则默认时间范围为当前时刻往前31天内。|
|skip_stop_words|否|指定是否在搜索时从**搜索关键词**中去掉**部分常见停用词**，例如“的”、“了”等，以优化搜索结果。<br>默认为false。<br>当搜索关键词的分词结果均为停用词时此字段将失效，仍然按照常规逻辑搜索；<br>注意，指定这个字段为`true`有可能导致搜索出不完全符合关键词的结果。|
|limit|否|用于分页查询，每次请求返回的数据上限。最大为100，不填默认为50|
|cursor|否|用于分页查询的游标，字符串类型，由上一次调用返回，首次调用可不填|
**IdInfo说明：** 
| 参数 | 是否必须 | 说明 |
| ------- | ---- | ---- |
|open_userid|否| 成员ID。会话者的身份类型为企业成员时填，优先识别该字段|
|external_userid|否| 客户ID。会话者的身份类型为为客户时填|

**返回结果：**
```
{
  "errcode": 0,
  "errmsg": "ok",
  "has_more": 1,
  "next_cursor": "CURSOR",
  "msg_list":[
    {
      "msgid": "xxxmsgid"
    },
    {
      "msgid": "yyymsgid"
    }
  ]
}
```
**参数说明：**

| 参数 | 说明 |
| ------- | ---- |
| errcode |错误码 |
|errmsg|错误码说明|
|has_more|是否还有更多数据未获取，不填默认为0<br>0: 否<br>1: 是|
|next_cursor|下一次请求的cursor值|
|msg_list|搜索结果的消息列表，按消息发送时间降序排序|
|msgid|每条消息对应的msgid|
>注：需要根据has_more是否为1来判断是否拉取结束，不能依赖返回的记录数。返回的记录数可能小于limit
