---
title: "下单购买"
doc_id: 55839
category_id: 100257
source_url: https://developer.work.weixin.qq.com/document/path/55839
---
服务商可通过该接口下单购买「数据与智能专区」中的会话内容数据接口。

**请求方式：** POST（**HTTPS**）
**请求地址：** https://qyapi.weixin.qq.com/cgi-bin/advanced_api/create_order?provider_access_token=ACCESS_TOKEN

**请求包体：**

```
{
  "advanced_api_type":1,
  "custom_corpid" : "wwxxx",
  "buyer_userid":"xxxx",
  "order_type":1,
  "chat_archive_api":{
    "edition":3,
    "old_edition":2,
    "purchase_count":100,
    "take_effect_time":1704038400,
    "old_edition_info":{
      "begin_time":1704038000,
      "end_time":1704038000
    },
    "target_edition_info":{
      "begin_time":1704038000,
      "end_time":1704038000
    }
  }
}
```

**参数说明：** 

| 参数 | 是否必须 | 说明 |
| ------- | ---- | ---- |
| provider_access_token | 是 | 应用服务商的接口调用凭证，获取方法参见[服务商的凭证](#15143 ) |
|advanced_api_type|否|购买的高级接口类型。1：会话内容数据接口，目前仅支持1，且默认值为1|
|custom_corpid|是|客户企业id。|
|buyer_userid|是|下单人。服务商企业内成员的明文userid。必须为服务商企业内具有“购买高级接口”或者“高级接口管理”权限的成员。最终也支持由其他人支付|
|order_type|否|订单类型。0-新购、1-增购、2-续期、3-升级。企业未购买过，默认新购。|
|chat_archive_api|否|当advanced_api_type为1是，必填，会话内容数据接口订单相关信息，参考ChatArchiveApi结构说明|

**ChatArchiveApi结构说明：**
| 参数 | 是否必须 | 说明 |
| ------- | ---- | ---- |
|edition|是|2-内外部会话，3-内外部会话及语音通话。仅未到期版本可增购；仅版本到期前60天起可续期；仅未到期版本、内外部会话版本可升级。当订单类型为升级时，editon字段填的是目标升级的版本|
|old_edition|否|2-内外部会话。订单类型为升级订单时，需要升级的旧版本。目前仅支持2。默认值为2|
|purchase_count|否|新购、增购、升级订单必须指定人数，续期订单可指定续期人数，范围为[1,1000000]（升级人数不可超出原版本已购人数）；续期订单若未指定人数，则默认为当前版本已购人数，若指定人数，则以指定人数为准|
|take_effect_time|否|新购、续期过期版本支持指定生效时间戳，若未指定则默认当天；其他情况下默认生效日期。</br>**默认生效日期说明：**</br>增购：默认为当天；</br>续期：未过期版本默认为到期日期；</br>升级：目标版本已购未生效 为 目标版本生效日期，目标版本已购已生效 或 未购买或者购买已过期 为 当天）。</br>有默认日期的，指定日期无效，若填了该字段，则该字段必须大于等于当天0点并且在90天内（以当天0点为起始点往后推90天，包含90天）。**注：指定的时间如果非0点，实际生效时间为指定日期的0点生效，如果为当天，则为当天0点生效** |
|old_edition_info|否|当增购、升级订单时，要增购或者升级的版本同时存在已生效跟待生效版本时，该字段可指定需要操作的版本对应的生效以及结束时间。若未指定则默认选择未过期且生效时间最早的版本。参考EditonInfo结构说明 |
|target_edition_info|否|当增购、升级订单时，要增购或者升级的版本同时存在已生效跟待生效版本时，该字段可指定需要操作的版本对应的生效以及结束时间。若未指定则默认升级到生效时间最晚的版本。参考EditonInfo结构说明|

**EditonInfo结构说明：**
| 参数 | 是否必须 | 说明 |
| ------- | ---- | ---- |
|begin_time|否|所选择的版本的生效时间。begin_time跟end_time必须同时指定，且必须是有效的。 |
|end_time|否| 所选择的版本的结束时间。begin_time跟end_time必须同时指定，且必须是有效的。|

**下单限制说明：**
>新购：当前企业已经购买过版本（包含已过期版本），不能再新购。
>增购：已购买版本已过期不能增购。
>续期：仅支持版本过期前60天开始下单，已过期的版本也支持续期。若当前存在待生效的版本，则不允许续期。
>升级：仅支持内外部会话版本升级为内外部会话及语音通话版本。升级的人数必须小于等于旧版本的人数。如果已经存在目标版本，目前也允许升级当前版本。已购版本已过期不支持升级

**返回结果：**
```
{
  "errcode": 0,
  "errmsg": "ok",
  "order_id": "xxxx"
}
```
**参数说明：**

| 参数 | 说明 |
| ------- | ---- |
| errcode |错误码 |
|errmsg|错误码说明|
|order_id|订单号|

**下单人权限说明：**
下单人需要具备“购买高级接口”或者“高级接口管理”权限。
- ![enter image description here](https://wework.qpic.cn/wwpic3az/164197_iu6O0ZYXTH2xIJx_1729578325/0)

**errcode说明** 待补充

| 错误码 | 说明 | 分类 |
| ------- | ---- | ---- | 
|701140| 已经购买过此版本，不能再新购，只能续期、增购、升级| 企业原因|
|701141| 未购买此版本或已经过期，不能增购、升级| 企业原因|
|701142| 购买信息已被其他请求更新，请重试| 企业原因|
|701143| 存在未支付或申请退款中的订单，不能下单| 企业原因|
|701146| 海外企业不能购买| 企业原因|
|701149| 过期前60天开始才可以续期| 企业原因|
|701163| 不合法的生效时间| 企业原因|
|701164| 非法的目标升级版本，目前仅支持升级为内外部会话及语音通话| 企业原因|
|84077| 订单价格过大，无法受理(目前不能超过500万)| 企业原因|
