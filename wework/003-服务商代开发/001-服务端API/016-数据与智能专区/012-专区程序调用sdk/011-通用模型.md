---
title: "通用模型"
doc_id: 56425
category_id: 100386
source_url: https://developer.work.weixin.qq.com/document/path/56425
---
[TOC]

应用在专区中的程序可调用本接口传入会话内容，使用企业微信通用的大语言模型进行会话分析，目前通用的大模型有 !!#ff0000 **Hunyuan-T1 · 深度思考**!!（灰度中）、 !!#ff0000 **DeepSeek-R1 · 深度思考**!!（灰度中） 与 !!#ff0000 **Hunyuan · 快速回答**!! 三种选项。

**详细说明**
> 该接口仅支持分析**文本、语音、音频存档消息**
> 目前该接口部分字段只支持第三方应用和代开发应用进行调用
> 输入协议中各类占位符完成替换后，总长度不超过大约30000个UTF-8字符，否则任务失败

模型的输入协议由管理端的配置决定，除自定义文本外，还可以使用以下4项数据：
- 会话内容
识别并替换占位符 **{chat}**，将传入的msg_list对应的会话分行拼接，示例：
```
A(员工)说：今天天气真不错！
B(客户)说：确实呀！
```
识别并替换占位符 **{chatcontent}**，将传入的msg_list对应的会话内容填入（不包含发送者），示例：
```
今天天气真不错！
确实呀！
```
- 知识集文档片段
识别并替换占位符 **{knowledge}**，通过对比与会话内容的相似度来提取到topK个知识集文档片段，示例：
普通知识集文件：
```
文档1：文本片段1
文档2：文本片段2
```
「问答对」知识集文件：
```
文档1：问题：问题1, 回答：答案1
文档2：问题：问题2, 回答：答案2
```
- 客户标签
识别并替换占位符 **{tagjson}**，通过将客户标签组内的标签展开并表示为 json，可以在输入协议中引导模型理解该 json，示例：
```
{
  "tag_group": [{
    "group_id": "xxx",
    "group_name": "xxx",
    "tag_list": [{
      "tag_id": "xxx",
      "tag_name": "xxx"
    },{
      "tag_id": "xxx",
      "tag_name": "xxx"
    }]
  }]
}
```
- 自定义变量
在接口中传入`name`和`value`组成的自定义变量对，识别并替换自定义占位符，将形如 **{$name$}** 的占位符内容替换为`value`，示例：
模型输入协议：
```
请执行{$task$}任务
```
接口传入：
```
"var_args": [{
  "name": "task",
  "value": "数据分析"
}]
```
替换结果为：
```
请执行数据分析任务
```
| 应用类型 | 权限要求 |
| -------- | ---- | 
|自建应用|需具备「!!#ff0000 数据与智能专区权限!!」 |
|代开发应用|需具备「!!#ff0000 数据与智能专区权限!!」 |
|第三方应用|需具备「!!#ff0000 数据与智能专区权限!!」 |

## 创建企微通用模型任务

**请求方法**
通过SDK调用，具体方式参考[专区程序使用指引](#54006)。

**请求接口名：**
create_ww_model_task

**请求包体：**

```
{
  "ability_id": "ABILITY_ID",
  "tag_group_list": [{
    "group_id": "GROUP_ID1"
  },{
    "group_id": "GROUP_ID2"
  }],
  "kb_id": "KBID",
  "kb_retrieval_words": "KB_RECALL_STRING",
  "msg_list": [{
    "msgid": "MSGID1",
    "encrypt_info": {
      "secret_key": "SECRETKEY1"
    }
  },{
    "msgid": "MSGID2",
    "encrypt_info": {
      "secret_key": "SECRETKEY2"
    }
  }],
  "model_id": "MODEL_ID",
  "need_think_result": false,
  "var_args": [{
    "name": "VAR_ARGS_NAME1",
    "value": "VAR_ARGS_VALUE1"
  },{
    "name": "VAR_ARGS_NAME2",
    "value": "VAR_ARGS_VALUE2"
  }]
}
```

**参数说明：** 

| 参数 | 是否必须 | 说明 |
| ------- | ---- | ---- |
|ability_id|是|模型能力id<br> **调用方为第三方/代开发应用时必填；只对第三方/代开发应用有效，通过在管理端配置能力获取** |
|kb_id|否|[知识集id](#53353)<br>**此字段和msg_list字段至少传入一个**|
|kb_retrieval_words|否|用于从知识集中检索相关内容，仅当传入了kb_id时有效；<br>长度限制为1到1000个utf-8字符；<br>**未传入此字段时，将使用传入的消息内容进行检索；**<br>**当未传入msg_list时，此字段必填**|
|msg_list|否|消息列表，最多1000个<br>**此字段和kb_id字段至少传入一个**|
|msg_list.msgid|是|每条消息对应的msgid。多次出现同一个msgid，以首次出现的为准。目前支持文本、语音、音频存档消息|
|msg_list.encrypt_info.secret_key|是|该消息的密钥，将encrypted_secret_key用RSA私钥解密后得到|
|model_id|否|调用的模型id，用于区分调用的是 Hunyuan-T1 · 深度思考（灰度中）、DeepSeek-R1 · 深度思考（灰度中）还是 Hunyuan · 快速回答 模型，在管理端获取。<br>只能传入 Hunyuan-T1 · 深度思考（灰度中）、DeepSeek-R1 · 深度思考（灰度中）或者 Hunyuan · 快速回答 模型的模型id，否则会报错。<br>不填默认为 Hunyuan · 快速回答 模型|
|need_think_result|否|是否返回模型的思考过程部分<br>默认为否<br>**选择不返回思考过程部分时，模型仍将进行深度思考，只是会将输出的思考过程部分进行过滤**|
|tag_group_list|否|客户标签组列表<br> **只对第三方/代开发应用有效** |
|tag_group_list.group_id|是|每个id代表一个[客户标签组](#17298)。<br> **只对第三方/代开发应用有效** |
|var_args|否|自定义变量列表，最多50个<br> **只对第三方/代开发应用有效** |
|var_args.name|是|自定义变量名<br>长度限制为1到32个字节<br> **只对第三方/代开发应用有效** |
|var_args.value|是|自定义变量值<br>长度限制为1到128个utf-8字符<br> **只对第三方/代开发应用有效** |

**model_id字段获取示例（Hunyuan-T1 · 深度思考 和 DeepSeek-R1 · 深度思考 灰度中）：**
- ![enter image description here](https://wework.qpic.cn/wwpic3az/772049_bZUnVryxRuG_FCF_1741922822/0)
- ![enter image description here](https://wework.qpic.cn/wwpic3az/956094_RQqsdTa0SH-tUnH_1742193859/0)
- ![enter image description here](https://wework.qpic.cn/wwpic3az/515742_yu_pd-FpRs2X-xx_1742193883/0)

**返回结果：**
```
{
 "errcode": 0,
 "errmsg": "ok",
 "jobid": "JOBID",
 "fail_list":[
 {
 "errcode": 710601,
 "errmsg": "xxx",
 "msgid": "MSGID2",
 "encrypt_info":{
 "secret_key": "SECRETKEY2"
 }
 }
 ]
}
```
**参数说明：**

| 参数 | 说明 |
| ------- | ---- |
| errcode |错误码 |
|errmsg|错误码说明|
|jobid|任务id。首次提交时返回|
|fail_tag_group_id_list|非法的客户标签组id列表|
|fail_list|提交出错的消息列表，只有msgid重复项返回至该列表，详见**FailMsg说明**|

**FailMsg说明：**

| 参数 | 说明 |
| ------- | ---- |
| errcode |错误码 |
|errmsg|错误码说明|
|msgid|每条消息对应的msgid，与入参对应|
|encrypt_info|每条消息对应的加密信息，与入参对应|
|encrypt_info.secret_key|加密消息用的secret_key|

## 获取企微通用模型结果

**请求方法**
通过SDK调用，具体方式参考[专区程序使用指引](#54006)。

**请求接口名：**
get_ww_model_result

**请求包体：**

```
{
 "jobid": "JOBID"
}
```

**参数说明：** 

| 参数 | 是否必须 | 说明 |
| ------- | ---- | ---- |
|jobid| 是 |任务id|

**返回结果：**
```
{
 "errcode": 0,
 "errmsg": "ok",
  "status": 1,
 "fail_list":[{
 "errcode": 710601,
 "errmsg": "xxx",
 "msgid": "MSGID"
 }],
  "response_data": "RESULT"
}
```
**参数说明：**

| 参数 | 说明 |
| ------- | ---- |
| errcode |错误码 |
|errmsg|错误码说明|
|status|任务执行状态<br>0: 执行未完成<br>1: 执行完成<br>2: 执行失败|
|fail_list| 错误的消息列表，如msgid不存在、非文本等，详见“创建企微通用模型任务”的**FailMsg说明**|
|response_data| 企微通用模型的返回结果<br>当"need_think_result"字段输入为true，且使用 Hunyuan-T1 · 深度思考 或 DeepSeek-R1 · 深度思考 模型时，返回的结果开头将是模型的思考过程，以<think>开头，</think>结尾 |

## 频率限制说明
- 每企业每天不超过1万次（按调用次数限制）。
- 每服务商每分钟调用量不超过100次，超过后将导致任务延迟或者任务失败。
- 若资源紧张，任务重试超过24小时仍未有足够资源执行，任务将失败
