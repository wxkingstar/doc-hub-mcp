---
title: "企业发表内容到客户的朋友圈"
doc_id: 34646
category_id: 96351
source_url: https://developer.work.weixin.qq.com/document/path/96351
---
最后更新：2025/09/11

[TOC]
##创建发表任务
企业和第三方应用可通过该接口创建客户朋友圈的发表任务。

**请求方式：**POST(**HTTPS**)
**请求地址：**https://qyapi.weixin.qq.com/cgi-bin/externalcontact/add_moment_task?access_token=ACCESS_TOKEN

**请求示例：**
```
{
  "text": {
    "content": "文本消息内容"
  },
  "attachments": [
    {
      "msgtype": "image",
      "image": {
        "media_id": "MEDIA_ID"
      }
    },
    {
      "msgtype": "video",
      "video": {
        "media_id": "MEDIA_ID"
      }
    },
    {
      "msgtype": "link",
      "link": {
        "title": "消息标题",
        "url": "https://example.link.com/path",
        "media_id": "MEDIA_ID"
      }
    }
  ],
   "visible_range":{
    "sender_list":{
      "user_list":["zhangshan","lisi"],
      "department_list":[2,3]
    },
    "external_contact_list":{
      "tag_list":[ "etXXXXXXXXXX", "etYYYYYYYYYY"]
    }
  }
}
```

**参数说明：**

| 参数 | 必须 | 说明 |
| :----------- | :--- | :----------------- |
| access_token | | 调用接口凭证 |
|visible_range|否|指定的发表范围；若未指定，则表示执行者为应用可见范围内所有成员|
|sender_list|否|发表任务的执行者列表，详见下文的“可见范围说明”|
|sender_list.user_list|否|发表任务的执行者用户列表，最多支持10万个|
|sender_list.department_list|否|发表任务的执行者部门列表|
|external_contact_list|否|可见到该朋友圈的客户列表，详见下文的“可见范围说明”|
|external_contact_list.tag_list|否|可见到该朋友圈的客户标签列表。**注：这里仅支持企业客户标签，不支持规则组标签**|
|text |否|文本消息|
|text.content|否|消息文本内容，不能与附件同时为空，最多支持传入2000个字（4000个字节），若超出长度报错'invalid text size'|
| attachments |否|附件，不能与text.content同时为空，最多支持9个图片类型，或者1个视频，或者1个链接。类型只能三选一，若传了不同类型，报错'invalid attachments msgtype'|
|msgtype |是|附件类型，可选image、link或者video|
|image |否|图片消息附件。最多支持传入9个；超过9个报错'invalid attachments size'|
|image.media_id|是|图片的素材id，长边不超过10800像素，短边不超过1080像素。可通过[上传附件资源](#34657)接口获得|
|link|否|图文消息附件。只支持1个；若超过1个报错'invalid attachments size'|
|link.title|否|图文消息标题，最多64个**字**(128个字节)|
|link.url|是|图文消息链接|
|link.media_id|是|图片链接封面，长边不超过10800像素，短边不超过1080像素，可通过[上传附件资源](#34657)接口获得|
|video|否|视频消息附件。最长不超过30S，最大不超过10MB。只支持1个；若超过1个报错'invalid attachments size'|
|video.media_id|是|视频的素材id，未填写报错"invalid msg"。可通过[上传附件资源](#34657)接口获得|

**可见范围说明**

visible_range，分以下几种情况：

1. 若只指定sender_list，则可见的客户范围为该部分执行者的客户，目前执行者支持传userid与部门id列表，注意不在应用可见范围内的执行者会被忽略。<br>

2. 若只指定external_contact_list，即指定了可见该朋友圈的目标客户（通过客户标签指定），此时会将该发表任务推给这些目标客户的应用可见范围内的跟进人。<br>
 
3. 若同时指定sender_list以及external_contact_list，会将该发表任务推送给同时满足以下条件的执行者：
（1）在sender_list中且在应用可见范围内的执行者；
（2）执行者有客户在external_contact_list当中。
执行者发表后仅external_contact_list指定的客户可见。<br>

4. 若未指定visible_range，则可见客户的范围为该应用可见范围内执行者的客户，执行者为应用可见范围内所有成员。

*注*：若指定external_contact_list列表，则该条朋友圈为部分可见；否则为公开

**权限说明：**
- 企业需要使用配置到“[可调用应用](#13473/开始开发)”列表中的自建应用secret所获取的accesstoken来调用（[accesstoken如何获取？](#10013/第三步：获取access_token)）。
- 自建应用调用，只会返回应用可见范围内用户的发送情况。
- 第三方应用或代开发自建应用调用需要企业授权**客户朋友圈**下**发表到成员客户的朋友圈**的权限
- 企业每个月允许通过api创建的朋友圈次数限制：10万
- 企业只允许创建10次/min。

**返回结果：**
```
{
  "errcode":0,
  "errmsg":"ok",
  "jobid":"xxxx"
}
```

**参数说明：**

| 参数 | 说明 |
| :----------- | :----------------- |
| errcode | 返回码 |
| errmsg | 对返回码的文本描述内容 |
| jobid |异步任务id，最大长度为64字节，24小时有效；可使用[获取发表朋友圈任务结果](#获取发表朋友圈任务结果)查询任务状态|

##获取任务创建结果
由于发表任务的创建是异步执行的，应用需要再调用该接口以获取创建的结果。
**请求方式：**GET（**HTTPS**）
**请求地址：**https://qyapi.weixin.qq.com/cgi-bin/externalcontact/get_moment_task_result?access_token=ACCESS_TOKEN&jobid=JOBID

**参数说明：**

| 参数 | 必须 | 说明 |
| ------------ | ------------ | ------------ |
| access_token | 是 | 调用接口凭证 |
| jobid | 是 | 异步任务id，最大长度为64字节，由[创建发表内容到客户朋友圈任务](#创建发表内容到客户朋友圈任务)接口获取 |

**权限说明：**

只能查询已经提交过的历史任务。

**返回结果：**

```
{
 "errcode": 0,
 "errmsg": "ok",
 "status": 1,
 "type": "add_moment_task",
  "result": {
    "errcode":0,
    "errmsg":"ok",
    "moment_id":"xxxx",
    "invalid_sender_list":{
      "user_list":["zhangshan","lisi"],
      "department_list":[2,3]
    },
    "invalid_external_contact_list":{
      "tag_list":["xxx"]
    }
  }
}

```
**参数说明：**

| 参数 | 说明 |
| ------------ | ------------ |
| errcode | 返回码 |
| errmsg | 对返回码的文本描述内容 |
| status | 任务状态，整型，1表示开始创建任务，2表示正在创建任务中，3表示创建任务已完成 |
| type | 操作类型，字节串，此处固定为add_moment_task|
| result | 详细的处理结果。当任务完成后此字段有效|
|result.errcode|返回码|
|result.errmsg|对返回码的文本描述内容|
| result.moment_id | 朋友圈id，可通过[获取客户朋友圈企业发表的列表](#25254/获取客户朋友圈企业发表的列表)接口获取朋友圈企业发表的列表|
|result.invalid_sender_list | 不合法的执行者列表，包括不存在的id以及不在应用可见范围内的部门或者成员|
