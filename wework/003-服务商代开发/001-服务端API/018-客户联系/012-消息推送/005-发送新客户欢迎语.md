---
title: "发送新客户欢迎语"
doc_id: 16489
category_id: 96356
source_url: https://developer.work.weixin.qq.com/document/path/96356
---
最后更新：2023/12/01

企业微信在向企业推送[添加外部联系人事件](#15260/添加外部联系人事件)时，会额外返回一个welcome_code，企业以此为凭据调用接口，即可通过成员向新添加的客户发送个性化的欢迎语。调用此接口前，请明确以下信息:
::: details 说明
1.为了保证用户体验以及避免滥用，企业仅可在收到相关事件后20秒内调用，且只可调用一次。
2.如果企业已经在管理端为相关成员配置了可用的欢迎语，则推送添加外部联系人事件时不会返回welcome_code。
3.如果欢迎语已成功下发给客户，应用再调用该接口时，将返回**41051（externaluser has started chatting）**。
4.**长期未登录企业微信的成员无法发送欢迎语。**
5.每次添加新客户时可能有多个企业自建应用/第三方应用收到带有welcome_code的回调事件，当多个应用同时调用发送欢迎语接口时，**仅最先调用接口的应用**可以成功，其他应用返回**41096(welcome msg is being distributed)**错误。请注意，返回41096错误码表示当前已有其他应用正在发送欢迎语，不代表欢迎语已经下发成功，存在下发失败的可能性，故调用方可以重试；如果返回了41051，则代表欢迎语已成功下发，无需重试。为了保证用户体验，请根据实际业务需求，合理配置应用可见范围。
:::

::: tip 提示
**旧接口[发送新客户欢迎语](#27719)已经废弃，接口升级后支持发送视频文件，并且最多支持同时发送9个附件。**
:::

**请求方式**: **POST(HTTP)**

**请求地址:**https://qyapi.weixin.qq.com/cgi-bin/externalcontact/send_welcome_msg?access_token=ACCESS_TOKEN

**请求示例**

```
{
  "welcome_code": "CALLBACK_CODE",
  "text": {
    "content": "文本消息内容"
  },
  "attachments": [{
 "msgtype": "image",
 "image": {
 "media_id": "MEDIA_ID",
 "pic_url": "http://p.qpic.cn/pic_wework/3474110808/7a6344sdadfwehe42060/0"
 }
 }, {
 "msgtype": "link",
 "link": {
 "title": "消息标题",
 "picurl": "https://example.pic.com/path",
 "desc": "消息描述",
 "url": "https://example.link.com/path"
 }
 }, {
 "msgtype": "miniprogram",
 "miniprogram": {
 "title": "消息标题",
 "pic_media_id": "MEDIA_ID",
 "appid": "wx8bd80126147dfAAA",
 "page": "/path/index.html"
 }
 }, {
 "msgtype": "video",
 "video": {
 "media_id": "MEDIA_ID"
 }
 },{
    "msgtype":"file",
    "file":
    {
      "media_id":"MEDIA_ID"
    }
  }]
}
```

**参数说明**:

|参数|必须|说明|
|:-----------|:---|:-----------------|
|access_token | 是 | 调用接口凭证 |
|welcome_code | 是 | 通过[添加外部联系人事件](#15260/添加外部联系人事件)推送给企业的发送欢迎语的凭证，有效期为**20秒**|
|text.content|否|消息文本内容,最长为4000字节|
|attachments|否|附件，最多可添加9个附件|
|attachments.msgtype|是|附件类型，可选image、link、miniprogram或者video|
|image.media_id|否|图片的media_id，可以通过[素材管理](#10112)接口获得|
|image.pic_url|否|图片的链接，**仅可使用[上传图片](#13219)接口得到的链接**|
|link.title|是|图文消息标题，最长为128字节|
|link.picurl|否|图文消息封面的url|
|link.desc|否|图文消息的描述，最长为512字节|
|link.url|是|图文消息的链接|
|miniprogram.title|是|小程序消息标题，最长为64字节|
|miniprogram.pic_media_id|是|小程序消息封面的mediaid，封面图建议尺寸为520*416|
|miniprogram.appid|是|小程序appid，必须是**关联到企业的小程序应用**|
|miniprogram.page|是|小程序page路径|
|video.media_id|是|视频的media_id，可以通过[素材管理](#10112)接口获得|
|file.media_id|是|文件的media_id, 可以通过[素材管理](#10112)接口获得|

>* text和attachments不能同时为空；
* text与附件信息可以同时发送，此时将会以多条消息的形式触达客户
* attachments中每个附件信息必须与msgtype一致，例如，msgtype指定为image，则需要填写image.pic_url或者image.media_id，否则会报错。
* media_id和pic_url只需填写一个，两者同时填写时使用media_id，二者不可同时为空。

**权限说明**:
- 企业需要使用配置到“[可调用应用](#13473/开始开发)”列表中的自建应用secret所获取的accesstoken来调用（[accesstoken如何获取？](#10013/第三步：获取access_token)）。
- 第三方应用需要拥有“企业客户权限->客户联系->给客户发送欢迎语”权限
- 企业成员需在应用的可见范围内

**返回结果**:

```
{
 "errcode": 0,
 "errmsg": "ok",
}
```

**参数说明**:

|参数|说明|
|:-----------|:-----------------|
| errcode | 返回码 |
| errmsg | 对返回码的文本描述内容 |
