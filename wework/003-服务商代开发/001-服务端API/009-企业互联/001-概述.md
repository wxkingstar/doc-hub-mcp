---
title: "概述"
doc_id: 24909
category_id: 96815
source_url: https://developer.work.weixin.qq.com/document/path/96815
---
最后更新：2022/01/11

[TOC]

---

## 企业互联是什么
企业互联是企业微信提供的，针对多个企业主体间跨组织沟通、协同的解决方案。
使用此功能，可以连接多个企业的通讯录、实现跨企业高效沟通，还能随时共享应用。

## 怎么互联
1、有互联权限的企业在 Web 管理后台，点击右上角“企业互联”进入互联管理后台
- ![](https://wework.qpic.cn/wwpic/143349_si_mHkhTQJaMlKG_1607348889/0)

2、在欢迎页点击“开始使用”按钮，系统自动创建一个互联
- ![](https://wework.qpic.cn/wwpic/66409_r5Sk1BrwQLSKSvl_1607348924/0)

3、进入首页，点击“常用入口”-“邀请加入”，在弹窗中邀请企业加入互联
- ![](https://wework.qpic.cn/wwpic/754964_lUVf8GFSS12Jijl_1607482186/0)

## 企业互联使用接口
上级企业将应用分享给下级企业后，需要使用特定的接口获取下级应用的身份和权限才能控制下级应用，因此需要做一定的适配。
对于第三方来说，当上级企业将第三方应用分享给下级企业后，企业微信会为每个下级企业分别安装授权该第三方应用，并[回调授权通知](#14951)给第三方，所以相当于是多了一种授权安装的渠道，不同的是，该情况下企业微信还会[回调共享应用事件](#25681)给第三方应用，之后第三方应用可[获取应用共享信息](#25951)，以及[获取下级企业付费版本信息](#25575)。
下面简要说明需要注意的地方。

### 获取应用共享信息
上级企业的管理员在管理端分享应用给下级企业后，会收到[共享应用事件回调](#12974/共享应用事件回调)，此时上级企业需要通过接口[获取应用共享信息](#24909)获取分享后的下级企业的corpid和应用id列表并保存起来，后面调接口的时候需要用到。

### 获取当前使用者信息
因为应用可以分享给多个下级企业，所以上级企业调用接口前，需要得知当前使用者到底属于哪个企业。
见[身份验证](#15232)相关接口。与普通应用使用方法的不同点在于：
- [构造网页授权链接](#15048)时，参数```appid```填**上级企业**的corpid （第三方应用无变化，参见[构造第三方应用oauth2链接](#15121)）
- [获取访问用户身份](#15047)，对于企业互联，返回的UserId格式如：CorpId/userid，分解即可得到下级企业的corpid（第三方应用无变化，参见[第三方获取访问用户身份](#15122)）

### 使用API接口
- 第三方应用。不同点在于：[获取企业永久授权码](#14942)接口不返回安装的管理员信息。
- 自建应用。不同点在于：需要换取下级企业的access_token来调接口，实现与下级应用交互
- ![](https://wework.qpic.cn/wwpic/687643_ZoQwRRn2TciCwk7_1606896145/0)
  ① [获取上级企业access_token](#15074)
  ② [获取下级企业access_token](#24919)
  ③ 使用第②步骤得到的**下级企业**的access_token调用各种API接口。例如通过调用[获取应用](#10087)接口获取下级应用的可见范围，通过调用[读取成员](#10019)接口获取下级用户详情

### 使用JSAPI接口
- 第三方应用。无变化
- 自建应用。与[普通企业使用JSAPI](#14931)不同点在于：需要使用下级企业 jsapi_ticket 来进行jsapi签名，并用下级企业的身份调用agentConfig
- ![](https://wework.qpic.cn/wwpic/756699_TSPPoYUDTLCStqs_1606896891/0)
  ① [获取上级企业access_token](#15074)
  ② [获取下级企业的access_token](#24919)
  ③ [获取jsapi_ticket并签名](#14924)。**特别注意**，需要使用第②步骤得到的**下级企业**的access_token获取jsapi_ticket
  ④ [agentConfig](#14931)。**特别注意**，此时```appId```和```agentId```参数，需要填**下级企业**的corpid和应用id。
  
### 使用小程序接口
- 第三方应用。无变化，通过[永久授权码获取企业access_token](#14944)。
- 自建应用。与普通企业[小程序登录流程](#16055)的不同点在于：需要使用[获取下级企业的小程序session](#25574)来转为下级企业的登录session
- ![](https://wework.qpic.cn/wwpic/14404_CXGambVmRe2CgYy_1606898722/0)
  ① [获取上级企业access_token](#15074)
  ② [获取上级sessionkey](#16056)
  ③ [获取下级企业的互联access_token](#24919)
  ④ [换取下级企业的sessionkey](#25574)
  
## 处理企业互联的回调事件
对于企业互联的应用，因为应用统一由上级企业管理，所以相关事件和消息均回调给**上级企业**。需注意以下几点：

- 新增共享应用事件回调。当应用分享或解除分享后，会触发该事件给上级企业或第三方服务商。收到该事件后，需要调用[获取应用共享信息](#24909)更新应用的分享列表并存储
 [第三方应用共享应用事件回调](#25681)。当上级企业管理员在管理端分享(或解除分享)应用给下级企业后（若需要敏感权限需下级企业确认），会推送该事件给服务商。
 [自建应用共享应用事件回调](#12974/共享应用事件回调)。当上级企业管理员在管理端分享(或解除分享)应用给下级企业后（若需要敏感权限需下级企业确认），会推送该事件给上级企业。

- [应用事件](#12974)。第三方应用无变化；对于自建应用，所有下级企业的用户产生的应用事件，均回调给上级企业的回调URL，而事件里的企业信息是下级企业的信息。
例如[成员关注及取消关注事件](#12974/成员关注及取消关注事件)：
  ```  
  <xml>
    <ToUserName><
- ![CDATA[toUser]]></ToUserName>
    <FromUserName><
- ![CDATA[UserID]]></FromUserName>
    <CreateTime>1348831860</CreateTime>
    <MsgType><
- ![CDATA[event]]></MsgType>
    <Event><
- ![CDATA[subscribe]]></Event>
    <AgentID>1</AgentID>
  </xml>```
  事件中```ToUserName```是**下级**企业corpid，```FromUserName```是**下级**企业的明文userid

- [回调消息](#12973)。第三方应用无变化；对于自建应用，所有下级企业的回调消息均推送给上级企业的回调URL，而消息里面的企业信息是下级企业的信息。

- [版本变更事件](#18271)。对于付费购买的第三方应用，上级企业付费等行为产生应用版本变更后，所有下级企业均会产生版本变更事件给服务商
