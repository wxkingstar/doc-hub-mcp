---
title: "步骤六：配置事件订阅"
source_url: https://open.feishu.cn/document/quick-start-of-personnel-and-attendance-management-system/step-6-configure-event-subscription
---
最后更新于 2024-04-19

# 步骤六：配置事件订阅

机器人接收的消息会以回调事件请求的形式，通过 POST 请求送达到服务端处理。本地服务启动后，回调事件无法请求到内网，需配置公网请求 URL。
本教程为了方便实现，使用了反向代理工具 [localtunnel](https://www.npmjs.com/package/localtunnel) 完成内网穿透，暴露本地服务的公网访问入口。**该工具仅适用于开发测试阶段，不可用于生产环境，使用前请确认是否符合所在公司网络安全政策。**

## 操作步骤

1. 运行以下命令获得 **公网** **URL**。

示例代码中用 3002 端口监听事件订阅。

```
    npx localtunnel --port 3002
    ```

![](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/0fc550b2769b7a06d86ab3ba9a84acf9_8ok07WvZ4q.png?height=76&lazyload=true&maxWidth=600&width=545)

2. 在应用详情页左侧进入 **事件与回调** 页面。
3. 在 **事件配置** 页签内，点击 **配置订阅方式** 右侧编辑图标。
4. 选择将 **事件发送至开发者服务器**，并在 **请求地址** 输出框填写使用代理工具生成的 `公网 URL+/webhook/event`。

保存请求网址 URL 时会请求到后端服务，**请求期间需保证本地服务为启动状态**。

![](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/c0ef66dd080cfbacf0be85ca11ceff0e_dKC3XyrNfk.png?height=942&lazyload=true&maxWidth=600&width=1760)

5. 在 **已添加事件** 区域点击 **添加事件**，搜索并添加以下事件。

- 审批通过
    - [员工离职](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/reference/contact-v3/user/events/deleted)
    - [员工入职](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/reference/contact-v3/user/events/created)
    - [接收消息](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/reference/im-v1/message/events/receive)
监听事件需要开通对应的权限，为了成功订阅上述事件，需要在 **权限管理** 页面，为应用开通上述事件所需权限。为了方便演示，在本教程中，已经在[步骤一](https://open.feishu.cn/document/home/quick-start-of-personnel-and-attendance-management-system/step-1-create-and-configure-an-application)中统一开通了所需权限。

![](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/f2f2c598eec38835e40d289d9ad6b2d4_oihjwnMg7c.png?height=1378&lazyload=true&maxWidth=600&width=2248)

6. 在 **回调配置** 页签内，点击 **订阅方式** 右侧编辑图标。
7. 在 **请求地址** 输入框，填入上一步使用代理工具生成的 `公网 URL+/webhook/message-card`。

保存请求网址 URL 时会请求到后端服务，**请求期间需保证服务为启动状态**。

![](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/052eeb3ade8c55711e7eb7164f471f11_AP6pn3NGBS.png?height=970&lazyload=true&maxWidth=600&width=1714)

8. 在 **已订阅的回调** 区域点击 **添加回调**，搜索并添加 **消息卡片回传交互（旧）** 回调。

![image.png](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/a62a2aba7c79861060aea038abd963d3_KoaBxImD5e.png?height=394&lazyload=true&maxWidth=600&width=2198)
