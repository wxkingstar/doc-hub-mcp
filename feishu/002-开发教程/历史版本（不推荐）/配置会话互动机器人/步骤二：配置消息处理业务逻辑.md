---
title: "æ­¥éª¤äºŒï¼šé…ç½®æ¶ˆæ¯å¤„ç†ä¸šåŠ¡é€»è¾‘"
source_url: https://open.feishu.cn/document/historical-version/interactive-session-based-robot/message-card-reference
---
æœ€åæ›´æ–°äº 2023-06-28

# æ­¥éª¤äºŒï¼šé…ç½®æ¶ˆæ¯å¤„ç†ä¸šåŠ¡é€»è¾‘

å½“ç”¨æˆ·åœ¨é£ä¹¦ä¼šè¯ä¸­å‘åº”ç”¨æœºå™¨äººå‘é€æ¶ˆæ¯æ—¶ï¼Œåº”ç”¨ä¼šå‘æœåŠ¡ç«¯è¯·æ±‚åœ°å€å‘é€ **æ¥æ”¶æ¶ˆæ¯** äº‹ä»¶ã€‚æœåŠ¡æ”¶åˆ°äº‹ä»¶æ•°æ®åï¼Œéœ€è¦æ ¹æ®æ¶ˆæ¯å†…å®¹åŒ¹é…å¹¶è¿”å›å‘½ä¸­çš„ç™¾ç§‘ä¿¡æ¯ã€‚æœ¬æ•™ç¨‹ä»…ä»‹ç»æœåŠ¡ç«¯ä»£ç çš„å¤„ç†é€»è¾‘ï¼Œå¹¶æä¾› JavaScript ç¤ºä¾‹ä»£ç ã€‚ä½ éœ€è¦æ ¹æ®æœ¬åœ°æœåŠ¡çš„å®é™…æƒ…å†µï¼Œè‡ªè¡Œå®Œå–„ä»£ç ä»¥å®ç°äº‹ä»¶å¤„ç†ä¸æ¶ˆæ¯å‘é€ã€‚

## ä»£ç é€»è¾‘è¯´æ˜

1. æ¥æ”¶å¼€æ”¾å¹³å°åº”ç”¨å‘é€çš„äº‹ä»¶å›è°ƒæ•°æ®ã€‚

æ•°æ®å†…å®¹ç¤ºä¾‹å¦‚ä¸‹ï¼ŒåŒ…å«æ¶ˆæ¯å‘é€è€…ä»¥åŠæ¶ˆæ¯å†…å®¹ç›¸å…³ä¿¡æ¯ã€‚

```JSON
    {
        "schema": "2.0",
        "header": {
            "event_id": "5e3702a84e847582be8db7fb73283c02", // äº‹ä»¶ID
            "event_type": "im.message.receive_v1", // äº‹ä»¶ç±»å‹
            "create_time": "1608725989000",// äº‹ä»¶åˆ›å»ºæ—¶é—´
            "token": "rvaYgkND1GOiu5MM0E1rncYC6PLtF7JV", //äº‹ä»¶ Token
            "app_id": "cli_9f5343c580712544", // åº”ç”¨ ID
            "tenant_key": "2ca1d211f64f6438" // ç§Ÿæˆ· Key
        },
        "event": {
            "sender": {
                "sender_id": { // ç”¨æˆ· ID ä¿¡æ¯é›†
                    "union_id": "on_8ed6aa67826108097d9ee143816345",
                    "user_id": "e33ggbyz",
                    "open_id": "ou_84aad35d084aa403a838cf73ee18467"
                },
                "sender_type": "user", // æ¶ˆæ¯å‘é€è€…ç±»å‹
                "tenant_key": "736588c9260f175e" // ç§Ÿæˆ·åœ¨é£ä¹¦ä¸Šçš„å”¯ä¸€æ ‡è¯†
            },
            "message": {
                "message_id": "om_5ce6d572455d361153b7cb51da133945", // æ¶ˆæ¯ ID
                "root_id": "om_5ce6d572455d361153b7cb5xxfsdfsdfdsf", // æ ¹æ¶ˆæ¯ ID
                "parent_id": "om_5ce6d572455d361153b7cb5xxfsdfsdfdsf", // çˆ¶æ¶ˆæ¯çš„ ID
                "create_time": "1609073151345", // æ¶ˆæ¯å‘é€æ—¶é—´
                "chat_id": "oc_5ce6d572455d361153b7xx51da133945", // æ¶ˆæ¯æ‰€åœ¨çš„ç¾¤ç»„ ID
                "chat_type": "group", // æ¶ˆæ¯æ‰€åœ¨çš„ç¾¤ç»„ç±»å‹
                "message_type": "text", // æ¶ˆæ¯ç±»å‹
                "content": "{\"text\":\"@_user_1 hello\"}", //æ¶ˆæ¯å†…å®¹
                "mentions": [ // è¢«æåŠç”¨æˆ·çš„ä¿¡æ¯
                    {
                        "key": "@_user_1",
                        "id": { // ç”¨æˆ· ID ä¿¡æ¯é›†
                            "union_id": "on_8ed6aa67826108097d9ee143816345",
                            "user_id": "e33ggbyz",
                            "open_id": "ou_84aad35d084aa403a838cf73ee18467"
                        },
                        "name": "Tom", // ç”¨æˆ·åç§°
                        "tenant_key": "736588c9260f175e" // ç§Ÿæˆ·åœ¨é£ä¹¦ä¸Šçš„å”¯ä¸€æ ‡è¯†
                    }
                ]
            }
        }
    }
   ```

2. è¯†åˆ«æ•°æ®ä¸­çš„äº‹ä»¶å†…å®¹ã€‚

ç”±äºè®¢é˜…çš„äº‹ä»¶å¯èƒ½ä¸æ­¢ä¸€ä¸ªï¼Œå› æ­¤éœ€è¦é€šè¿‡ **æ¥æ”¶æ¶ˆæ¯** äº‹ä»¶çš„ç‰¹å¾ï¼Œè¯†åˆ«è¯¥äº‹ä»¶ã€‚æ ¹æ® [æ¥æ”¶æ¶ˆæ¯](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/reference/im-v1/message/events/receive) äº‹ä»¶æ–‡æ¡£ï¼Œè·å–è¯¥äº‹ä»¶çš„å…³é”®ç‰¹å¾ï¼šäº‹ä»¶ç±»å‹ï¼ˆ`header.event_type`ï¼‰ä¸º`im.message.receive_v1`ã€‚

3. æå–ç”¨æˆ·å‘é€æ¶ˆæ¯çš„å†…å®¹ä¸ IDã€‚

- åœ¨æ¥æ”¶æ¶ˆæ¯äº‹ä»¶å‚æ•°ä¸­ï¼Œç”¨æˆ·å‘é€çš„å†…å®¹åŒ…å«åœ¨`event.message.content`å­—æ®µï¼Œè¯¥å­—æ®µæ˜¯ä¸€ä¸ªåºåˆ—åŒ–çš„ JSON å­—ç¬¦ä¸²ï¼Œå› æ­¤éœ€è¦ååºåˆ—åŒ–åå†ä½¿ç”¨ã€‚

åç»­éœ€è¦æ ¹æ®ç”¨æˆ·å‘é€çš„å†…å®¹è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œæœç´¢ä¸å†…å®¹ç›¸å…³çš„ç™¾ç§‘ä¿¡æ¯ã€‚

- åœ¨æ¥æ”¶æ¶ˆæ¯äº‹ä»¶å‚æ•°ä¸­ï¼Œç”¨æˆ·å‘é€æ¶ˆæ¯çš„ ID å¯¹åº”`event.message.message_id`å­—æ®µã€‚

åç»­é€šè¿‡`message_id`å®šä½å¹¶å›å¤ç”¨æˆ·ã€‚

4. è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚

ä¾‹å¦‚ï¼ŒåŸºäºç”¨æˆ·æ¶ˆæ¯å†…å®¹ï¼Œåœ¨ä¼ä¸šå†…ç½‘æœç´¢å¹¶ä¿å­˜ç›¸åŒ¹é…çš„ç™¾ç§‘ä¿¡æ¯ã€‚

5. è°ƒç”¨å¼€å‘å¹³å°çš„[å›å¤æ¶ˆæ¯](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/reference/im-v1/message/reply)æ¥å£ï¼Œå°†ä¿å­˜çš„ç™¾ç§‘ä¿¡æ¯é€šè¿‡`message_id`å›å¤ç»™ç”¨æˆ·ã€‚

## ç¤ºä¾‹ä»£ç 

æ•´ä½“é€»è¾‘ç”¨ JavaScript ä»£ç æè¿°å¦‚ä¸‹ã€‚

```JavaScript
const axios = require('axios')
// å‡è®¾dataä¸ºå›è°ƒè¿‡æ¥çš„äº‹ä»¶ä½“åŸå§‹å†…å®¹
function keywords_search(data) {
    if (data.header.event_type !== 'im.message.receive_v1') {
        return
    }
    // è·å–æ¶ˆæ¯å†…å®¹å’Œmessage id
    const {content, message_id} = data.event.message
    // ååºåˆ—åŒ–ï¼Œå¾—åˆ°ç”¨æˆ·è¾“å…¥çš„å†…å®¹
    const {text} = JSON.parse(content)
    // è¿™é‡Œæ˜¯è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘å¤„ç†
    const resp = await custom_business_logic(text)
    if (resp.code !== 0) {
        return resp
    }
    // æ‹¿åˆ°ä¸šåŠ¡å¤„ç†ç»“æœ
    const result = resp.data
    const card = `{
  "header": {
    "title": {
      "tag": "lark_md",
      "i18n": {
        "zh_cn": "ğŸ” æŠ“æ‰‹"
      }
    },
    "template": "blue"
  },
  "i18n_elements": {
    "zh_cn": [
      {
        "tag": "div",
        "fields": [
          {
            "is_short": false,
            "text": {
              "tag": "lark_md",
              "content": "result",
            }
          }
        ]
      }
    ]
  }
}`
    try {
        const resp = await axios.post("https://open.feishu.cn/open-apis/im/v1/messages/${message_id}/reply", {
            msg_type: "interactive",
            content: "${JSON.stringify({card})}",
        })
        return {
            code: resp.data.code,
            msg: resp.data.msg
        }
    } catch(e) {
        return {
            code: -1,
            msg: "${e}"
        }
    }
}
```
