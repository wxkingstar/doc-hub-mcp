---
title: "版本管理"
source_url: https://open.feishu.cn/document/native-integration/specification-description/version-management
---
最后更新于 2024-08-15

# 版本管理
## 简介

版本号管理旨在解决飞书原生集成过程中的两个问题：一是支持协议组件更新后不触发飞书自有版本号更新，二是支持客户端进行应用内（in-app）升级。

## 使用说明

### 准备工作
- 获取并安装飞书原生集成开发工具。详见开发者[集成指南](https://open.feishu.cn/document/uAjLw4CM/ukzMukzMukzM/native-integration/open-scene-introduction/android-development/integration-guide)
- 登录账号并初始化模版工程（账号所属租户应为离线模式）

### 查看最新版本号

#### 离线模式

- 方式一：前往私有化部署的运维平台，查看目前线上版本已经推送成功的第三方 SDK 的版本号（Alchemy Version）。

![image.png](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/9bd5959ec800e3f94fea681f6a603348_6rmGkfGT52.png?height=992&lazyload=true&maxWidth=800&width=2788)

<br>
- 方式二：前往移动端 app，打开 **个人中心** - **设置** - **关于**，查看最新版本信息（不推荐，存在版本灰度范围影响，可能查询结果并非线上最新版本）。移动端示例如下：
![image.png](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/01b2a5b9d8092897dc3032d47f914ce1_f4gmkJCVhd.png?height=521&lazyload=true&maxWidth=800&width=858)
**注意事项**：在线模式暂未提供

### 更新本地版本号

1. 查看模版工程目录下，/alchemy/base_config.json

![](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/a1363e45917b65704447654768b62e76_e5is68Lh28.png?height=302&lazyload=true&maxWidth=800&width=1054)
2. 根据上一步查看的最新版本号，添加alchemyVersionCode（如果之前已经添加，则可直接修改alchemyVersionCode的属性值），具体步骤为：
	1. 在base_config.json中增加新的属性**alchemyVersionCode**
	1. 将**alchemyVersionCode**属性值设置为最新版本号的**字符串形式**

以下方截图为例，最新版本号为88，那么该值设置为 **"88"**

![](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/bb52753bb888247e2d2a4ded4241be48_thWJVXsvCg.jpeg?height=592&lazyload=true&maxWidth=400&width=632)
**注意事项**：**alchemyVersionCode**的值必须为**大于0的整型数**的**字符串形式**，其他形式视为非法。比如
  - **合法: "1"**
  - **合法: "88"**
  - 非法: "1.3.4"
  - 非法: "-1"
  - 非法: "test"
  - 非法: 1
  - 非法: 1.2

### 本地验证
在更新 JSON 文件中的 alchemyVersionCode 后，使用飞书原生集成工具进行本地构建。构建完成后，将获得已修改的 IPA 文件/ APK 文件。自动或手动重签后，安装并验证 App 关于中的版本号是否已经更新。

### 升级推送

在模版工程的 alchemy 文件夹下
- iOS（执行以下命令进行推送 IPA 文件或 CDN 地址）：
```
python3 upload_alchemy_version.py -i ${ipa包的绝对路径 或 plist的url)} -o ${保存json的绝对路径} -l $(项目alchemy目录下env_config.json的绝对路径)
```
- Android（其中cdnUrl 参数必填）：
```
./gradlew larkVersionPublish --cdnUrl=${apk的下载地址} --output=${保存json的绝对路径}。
```
- 等待当前环境服务部署，脚本执行结果会展示升级配置 JSON。JSON 用于其他环境升级部署使用。
  **注意事项**：开发使用测试环境进行版本号发布，可先验证测试环境升级 case，测试通过后，可以直接在将脚本返回的 JSON 导入正式环境的运维平台，进行发布。不需要在本地再次使用脚本操作 IPA 文件/ APK 文件。

- 验证通过后，前往运维平台进行升级发布。

### 查看升级效果
前往移动端 app，打开 **个人中心** - **设置** - **关于**

![image.png](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/772ab279e2de14ab4d059f88acbba382_YbzoAi8Gob.png?height=754&lazyload=true&maxWidth=400&width=577)

## 版本号示例
移动端展示格式：
- iOS：{飞书版本号}-omega{第三方 SDK 的版本号}-{飞书代码版本标识号}
- Android：{飞书版本号}-omega{第三方 SDK 的版本号}
