---
title: "获取命中关键词规则的会话记录"
doc_id: 53347
category_id: 100029
source_url: https://developer.work.weixin.qq.com/document/path/100029
---
最后更新：2025/09/09

通过该接口，可以获取一段时间内命中关键词规则或关键行为的会话记录。

**权限说明**
> 1. 只可获取5天内的企业客户会话记录数据
> 2. 一次拉取调用上限1000条会话记录，可以通过分页拉取的方式来依次拉取

| 应用类型 | 权限要求 |
| -------- | ---- | 
|自建应用|需具备「!!#ff0000 数据与智能专区权限!!」 |
|代开发应用|需具备「!!#ff0000 数据与智能专区权限!!」|
|第三方应用|需具备「!!#ff0000 数据与智能专区权限!!」|

**请求方法**
通过SDK调用，具体方式参考[专区程序使用指引](#54006)。

**请求接口名：** 
get_hit_msg_list

**请求包体：**

```
{
  "cursor":"RMTJID",
  "token":"NGEJKGOEGJKOEGNEOAGOEGOKEGHOEEEEE",
  "need_detail":1,
  "limit":200
}
```

**参数说明：** 

| 参数 | 是否必须 | 说明 |
| ------- | ---- | ---- |
|cursor|否|上一次调用时返回的next_cursor，第一次拉取可以不填。若不填，从5天内最早的消息开始返回。不多于64字节|
|token|否|回调事件返回的 `token` 字段，10分钟内有效；建议都从回调事件中取出token填上，否则接口会有严格的频率限制。不多于128字节|
|need_detail|否|是否需要消息详情，默认为否|
|limit|否|每次调用返回的记录数，默认为200，最大不超过1000|
|begin_time| 否| 仅用于需要重新拉取数据而不清楚具体cursor的场景，正常情况不应该使用该字段。会从begin_time附近的数据开始返回。|

**返回结果：**
```
{
  "errcode": 0,
  "errmsg": "ok",
  "has_more": 1,
  "next_cursor": "JGNLGEHJGIE",
  "msg_list": [{
    "msgid": "xxxmsgid",
    "msg_detail": {
      "sender": {
        "type": 1,
        "id": "woxxxxxmmgjiegjie"
      },
      "receiver_list": [{
          "type": 1,
          "id": "woAAAAAAAAAAA"
        },
        {
          "type": 2,
          "id": "wmXXXXXXXXXXXXX"
        }
      ],
      "chatid": "wrXXXXXXXXXX",
      "send_time": 166666666,
      "msgtype": 2,
      "service_encrypt_info": {
        "encrypted_secret_key": "KEYAAAAAAABBBBBB",
        "public_key_ver": 1
      }
    },
    "hit_rule_list": [{
      "rule_id": "vvvvvvvvvvvvvvvvvxxxx",
      "has_hit_keyword": false,
      "semantics_list": [1, 2]
    }]
  }]
}
```
**参数说明：**

| 参数 | 说明 |
| ------- | ---- |
| errcode |错误码 |
|errmsg|错误码说明|
|has_more|是否还有更多数据。0-否；1-是。|
|next_cursor|下次调用带上该值，则从当前的位置继续往后拉，以实现增量拉取。强烈建议对该字段入库保存，每次请求读取带上，请求结束后更新。避免因意外丢，导致必须从头开始拉取，引起消息延迟。|
|msg_list|客户会话列表|
|msgid|每条消息对应的msgid|
|msg_detail|消息详情，详见[MsgDetail](#MsgDetail)。`仅need_detail=1时返回`|
|hit_rule_list|命中的关键词规则列表|
|hit_rule_list.rule_id|命中的规则id|
|hit_rule_list.has_hit_keyword|是否命中该规则的关键词列表|
|hit_rule_list.semantics_list|该规则中命中的关键行为列表，1：红包；2：手机号码；3：邮箱地址；4：微信名片；5：带二维码图片；6：撤回消息；7：银行卡号；8：身份证号；9-发送文件（不包括微盘文件）；10-发送链接（发送链接消息或者发送的文本消息中包含链接）；11-发送小程序；12-发送客户欢迎语|

**MsgDetail**
|参数|说明|
|----|----|
|sender.type|消息发送者身份类型。1：员工；2：外部联系人。|
|sender.id|消息发送者的id，当消息发送者为员工时，该字段为员工的userid；当消息发送者的身份为外部联系人时，该字段为外部联系人的id。|
|chatid|群ID，当消息是群消息的时候会返回该字段。|
|receiver_list.type|消息接受者的身份类型。1：员工；2：外部联系人; 3：机器人。|
|receiver_list.id|当接收者身份类型为员工时，该字段为员工open_userid；当接收者身份类型为外部联系人时，该字段为外部联系人id；当接收者身份类型为机器人式为机器人ID。|
|send_time|消息发送时间对应的unix时间戳。|
|msgtype|消息类型。枚举值定义见下方[消息类型](#消息类型)。|
|service_encrypt_info.encrypted_secret_key|加密后的密钥，使用[设置公钥](#51799)设置的公钥进行加密，需要服务商用私钥解密后才可传入[会话展示组件](#50920)。|
|service_encrypt_info.public_key_ver|公钥版本号。|

**消息类型**
| 类型| 说明|
|-----|-----|
|1|文本|
|2|图片|
|4|链接|
|5|小程序|
|6|语音消息|
|8|文件|
|9|名片|
|13|红包|
|20|图文混合消息|
|21|音频存档|
