---
title: "批量获取审批单号"
doc_id: 30794
category_id: 94603
source_url: https://developer.work.weixin.qq.com/document/path/94603
---
最后更新：2024/07/05

第三方应用开发者可通过安装在企业的第三方应用的AccessToken调用此接口，以获取授权企业一段时间内企业微信“审批应用”单据的审批编号，支持按模板类型、申请人、部门、申请单审批状态等条件筛选。第三方应用必须开启授权审批接口权限。

一次拉取调用最多拉取100个审批记录，可以通过多次拉取的方式来满足需求，但调用频率不可超过600次/分。

**请求方式：**POST（**HTTPS**）
**请求地址：**https://qyapi.weixin.qq.com/cgi-bin/oa/getapprovalinfo?access_token=ACCESS_TOKEN

**请求示例：**

```json
{
 "starttime" : "1569546000",
 "endtime" : "1569718800",
 "new_cursor" : "",
 "size" : 100 ,
 "filters" : [
 {
 "key": "template_id",
 "value": "ZLqk8pcsAoaXZ1eY56vpAgfX28MPdYU3ayMaSPHaaa"
 },
 {
 "key" : "creator",
 "value" : "WuJunJie"
 },
 {
 "key" : "department",
 "value" : "1"
 }, 
 {
 "key" : "sp_status",
 "value" : "1"
 } 
 ]
}
```

**参数说明：**

| 参数 | 必须 | 说明 |
| ------------ | ------------ |
| access_token | 是 | 调用接口凭证。必须使用第三方应用accesstoken获取，获取方式参考：[文档-获取access_token](https://work.weixin.qq.com/api/doc/90001/90143/90605) （accesstoken决定了此服务商模板拉取审批表单号的目标企业，请务必保证准确） |
| starttime | 是 | 审批单提交的时间范围，开始时间，UNix时间戳 |
| endtime | 是 | 审批单提交的时间范围，结束时间，Unix时间戳 |
| new_cursor | 是 | 分页查询游标，默认为空串，后续使用返回的new_next_cursor进行分页拉取|
| size | 是 | 一次请求拉取审批单数量，默认值为100，上限值为100。若仅允许获取在第三方应用可见范围内申请人提交的表单，返回的sp_no_list个数可能和size不一致，开发者需用next_cursor判断表单记录是否拉取完|
| filters | 否 | 筛选条件，可对批量拉取的审批申请设置约束条件，支持设置多个条件 |
| └ key | 否 | 筛选类型，包括：</br>template_id - 目标企业审批模板模板id；</br>creator - 申请人；</br>department - 审批单提单者所在部门；</br>sp_status - 审批状态;</br>record_type - 审批单类型属性，1-请假；2-打卡补卡；3-出差；4-外出；5-加班； 6- 调班；7-会议室预定；8-退款审批；9-红包报销审批</br></br>注意:</br>1、仅“部门”支持同时配置多个筛选条件。</br>2、不同类型的筛选条件之间为“与”的关系，同类型筛选条件之间为“或”的关系 </br> 3、record_type筛选类型仅支持2021/05/31以后新提交的审批单，历史单不支持表单类型属性过滤|
| └ value | 否 | 筛选值，对应为：template_id-模板id；creator-申请人userid ；department-所在部门id；sp_status-审批单状态（1-审批中；2-已通过；3-已驳回；4-已撤销；6-通过后撤销；7-已删除；10-已支付） |
> 1 接口频率限制 600次/分钟
2 请求的参数endtime需要大于startime， 起始时间跨度不能超过31天；
3 老的分页游标字段cursor和next_cursor待废弃，请开发者使用新字段new_cursor和new_next_cursor。

---

**返回结果 ：**

```json
{
 "errcode": 0,
 "errmsg": "ok",
 "sp_no_list": [
 "201909270001",
 "201909270002",
 "201909270003"
 ]
}
```

**权限说明：**
| 应用类型 | 权限要求 |
| -------- | ---- | 
|自建应用|配置到「[审批 - 可调用接口的应用](#17893/配置可调用接口的应用)」中 |
|代开发应用|具有「审批」权限| 
|第三方应用|具有「审批」权限|

*注：* 从2023年12月1日0点起，不再支持通过系统应用secret调用接口，存量企业暂不受影响 [查看详情](https://developer.work.weixin.qq.com/document/51165)

**参数说明：**

| 参数 | 说明 |
| ------------ | ------------ |
| sp_no_list | 审批单号列表，包含满足条件的审批申请 |
|new_next_cursor|后续请求查询的游标，当返回结果没有该字段时表示审批单已经拉取完|

---

**错误说明：**

| 错误码 | 说明 |
| ------------ | ------------ |
|301055|无审批应用数据拉取权限|
|301025|请求参数错误|
|301026|批量拉取审批单内部接口失败|
|301112|请缩小查询时间范围重试|
