---
title: "概述"
doc_id: 51539
category_id: 99555
source_url: https://developer.work.weixin.qq.com/document/path/99555
---
最后更新：2024/04/08

[TOC]

企业微信新向服务商开放会话内容存档三方接口，经客户企业授权后，服务商可通过接口获取企业内部员工以及员工和客户间的会话记录(不含内容)，并使用展示组件安全展示会话内容，用以满足企业的合规检查和提升客户服务质量的诉求。
- ![image](https://wdoc-76491.picgzc.qpic.cn/MTY4ODg1MDUyMjMwMDk1MA_950979_IFaK5IFT
- ![enter image description here](https://wework.qpic.cn/wwpic3az/932940_dxZ4uB7SSKSpzps_1709212868/0)

## 一、如何接入
合作伙伴可按照以下流程接入：
1. **提交申请：**在「服务商后台-应用管理-开发配置-会话内容存档接口授权」或「桌面端服务商助手-工具-通用配置-开发配置-会话内容存档接口授权」申请接入，申请时需配置基础信息、权限信息、开发信息，提交申请后企业微信将进行审核，审核通过将通过服务商助手通知。
- ![enter image description here](https://wework.qpic.cn/wwpic3az/742150_DrTtJAdrREKBze8_1709278367/0)
2. **实现产品功能：**服务商在产品中接入「会话内容存档三方接口」以实现对应的产品功能，下文【二、可实现的功能示例】对常见的功能及所用到的接口做了详细介绍，服务商可进行参考。
4. **获取企业授权并提供产品：**「会话内容存档三方接口」需单独授权，服务商可将权限授权的二维码/链接发给企业获取授权；企业授权时，支持选择授权的版本和成员范围。授权完成后，服务商可调用对应企业的接口并提供相应产品服务。

## 二、可实现的功能示例
服务商可根据自身的产品定位、使用场景、客户需求等综合考虑要基于「会话内容存档三方接口」实现的功能，以下是对基于「会话内容存档三方接口」实现的常见功能及用到的接口的说明，供服务商参考。
### 1. 会话内容查看
**功能：**查看员工之间、员工和客户间的会话内容
- 查看维度：可按照员工或客户的维度去查看，如查看员工 A 和每一位客户的会话内容；也可按照消息的维度去查看，如查看具体某一条消息的内容
- 消息类型：支持文本、图片、表情、链接、小程序、语音、视频、文件等多种消息类型，全部消息类型可查看[获取会话记录接口文档](https://developer.work.weixin.qq.com/document/path/97240)

**使用到的API/能力：**
| API/能力| API/能力说明 |
| ------ | ------ |
| [获取会话记录](#42660) |获取授权范围内成员的会话记录，包括会话ID、消息ID、消息发送人、消息接收人、消息发送时间、消息类型 |
| [会话展示组件](#50920) | 可使用展示组件展示群名称、会话内容 |

### 2. 会话内容搜索
**功能**：
- 搜索会话消息：对会话消息内容进行搜索和展示，展示时支持高亮显示匹配到的搜索词
- 搜索会话名称：对会话名称进行搜索和展示

**使用到的API/能力：**
| API/能力| API/能力说明 |
| ------ | ------ |
| [会话名称搜索](#50684)|基于名称搜索群 |
| [会话消息搜索](#43533) |基于名称搜索会话消息 |
| [会话展示组件](#50920) | 可使用展示组件展示群名称、会话内容 |

### 3. 会话内容审计
**功能：**对会话内容进行审计，可设定审计的会话范围，并针对会话范围中出现的敏感内容和敏感行为进行预警
- 敏感内容预警：可自定义设置敏感词（如“回扣”“红包”等），当会话内容中含有敏感词时，可向审核人员推送提醒
- 敏感行为预警：可定义设置敏感行为（如“发送红包”“发送文件”“发送手机号码”等），当会话内容中含有敏感行为时，可向审核人员推送提醒

**使用到的API/能力：**
| API/能力| API/能力说明 |
| ------ | ------ |
|[关键词规则管理](#42636) |可通过定义关键词、关键行为来定义一个关键词规则，命中规则的消息将回调通知 |
| [获取命中关键词规则的会话记录](#42728) |可获取一段时间内命中关键词规则的会话记录 |
| [会话展示组件](#50920) | 可使用展示组件展示群名称、会话内容 |

### 4. 会话内容导出
**功能：**导出某部分会话内容，如导出员工 A 和客户 B 的会话内容 或 发送涉嫌敏感内容的会话内容，方便审核人员进行二次审核

**使用到的API/能力：**
| API/能力| API/能力说明 |
| ------ | ------ |
|[会话内容导出](#52354) |可通过接口提交导出任务，在导出的文件中由企业微信进行转译，转译成正确的内容之后展示给用户 |

### 5. 会话摘要提取
**功能：**针对某部分会话内容，快速提取摘要。如针对员工 A 和客户 B 的沟通内容，快速提取一段会话摘要，方便审核人员进行审核

**使用到的API/能力：**
| API/能力| API/能力说明 |
| ------ | ------ |
|[会话内容分析](#50846) |通过接口提交分析任务，对多条会话消息批量分析并提取摘要 |

### 6. 关键词识别
**功能：**可定义一组关键词，当会话内容中命中关键词时进行相应的产品处理。如设定某些商品的关键词，如服饰行业的“卫衣”“运动裤”等，当客户发送的消息包含对应的关键词，在消息侧边栏展示对应商品，方便导购发送到会话中

**使用到的API/能力：**
| API/能力| API/能力说明 |
| ------ | ------ |
|[关键词规则管理](#42636) |可通过定义关键词、关键行为来定义一个关键词规则，命中规则的消息将回调通知 |
| [获取命中关键词规则的会话记录](#42728) |可获取一段时间内命中关键词规则的会话记录 |
| [会话展示组件](#50920) | 可使用展示组件展示群名称、会话内容 |

### 7. 服务质量评估
**功能：**基于员工和客户的会话内容，对员工的客户服务质量进行评估，如：
- 服务响应时间：评估员工回复客户消息的时间，对回复超时的 case 进行记录和统计
- 客户情感分析：评估员工和客户沟通过程中，客户的情感状态，对于负面的 case 进行记录和统计

**使用到的API/能力：**
| API/能力| API/能力说明 |
| ------ | ------ |
| [获取会话记录](#42660) |获取授权范围内成员的会话记录，包括会话ID、消息ID、消息发送人、消息接收人、消息发送时间、消息类型 |
|[会话内容分析](#50846) |通过接口提交分析任务，分析会话消息的情感状态（正中负） |

### 8. 会话数据统计
**功能：**对企业会话数据进行统计，包括但不限于：
- 员工联系客户统计：员工与客户的聊天总数、发送的消息数、客户回复的占比、平均的回复时长等
- 员工联系客户的详情：针对每一位员工，查看该员工在一段时间内联系客户的数据详情
- 会话消息类型统计：统计会话中的各种消息类型的数据，如文本消息、图片消息、小程序消息、已撤回消息等的数据

**使用到的API/能力：**
| API/能力| API/能力说明 |
| ------ | ------ |
| [获取会话记录](#42660) |获取授权范围内成员的会话记录，包括会话ID、消息ID、消息发送人、消息接收人、消息发送时间、消息类型 |

### 9. 会话内容自定义分析
**功能：**针对会话内容的其他自定义分析功能，如词频分析、客户画像分析等，且相关的分析代码为服务商自行实现

**使用到的API/能力：**
| API/能力| API/能力说明 |
| ------ | ------ |
| [数据分析专区](#50544) |服务商可将分析代码打包成镜像部署到企业微信的数据分析专区，数据分析专区与外界网络隔离，只能通过专属网络访问专区接口，以拉取消息内容到专区服务上进行分析。既保证服务商功能的完整性，同时保证数据的安全性。 |

## 三、会话内容存档接口
| 序号 | 接口 | 接口描述| 使用场景举例（供参考） |
| --- | ------ | ------ | ------- |
|1|[获取会话记录](#42660)|可获取授权范围内成员的会话记录，包括会话ID、消息ID、消息发送人、消息接收人、消息发送时间、消息类型|● 结合展示组件，展示成员会话内容<br>● 统计分析成员会话数据|
|2|[会话展示组件](#50920)|可使用展示组件展示群名称、会话内容|● 结合获取会话记录接口，展示成员会话内容|
|3|[获取内部群消息](#50675)|可获取企业内部群信息，包括群主、群成员、群创建时间、群成员入群时间|● 结合获取会话记录接口、会话展示组件，按群的维度展示群中会话内容和群信息|
|4|[会话名称搜索](#50684)|基于名称搜索群|● 用于搜索群，查看指定群名的群会话内容|
|5 |[会话消息搜索](#43533) |基于名称搜索会话消息 |● 用于搜索消息，查看指定内容对应的会话消息 |
|6 |[关键词规则管理](#42636) |可通过定义关键词、关键行为来定义一个关键词规则，命中规则的消息将回调通知 |● 敏感会话内容、敏感行为预警相关功能<br>● 基于特定内容、行为实现的产品功能 |
|7 |[获取会话同意情况](#50859)|获取成员客户的会话存档同意情况 |● 基于成员客户会话存档同意情况实现的展示分析功能 |
|8 |[会话情感分析](#50846) |获取会话消息的情感状态（正中负） |● 评估企业客户服务质量 |
|9 |[客户同意会话存档回调事件](#50867)|成员客户同意会话存档的事件通知 |● 基于成员客户会话存档同意情况实现的展示分析功能 |
|10 |[产生会话回调事件](#42412) |新产生会话消息通知事件 |● 产生新会话消息时去获取会话记录，避免无效请求 |

## 四、接口调用流程说明
- ![接口调用流程.png](https://wework.qpic.cn/wwpic3az/593083_GM6cIS5pSz2S64a_1702900832/0)

**步骤说明：**
1.2 参考[ 授权成功事件](#42425) 
1.3 参考[设置公钥](#51799)
2.3 参考[ 产生会话回调事件](#42412) 
2.4 参考[获取会话记录](#42660)
3.2 参考[设置公钥](#51799)
3.3 参考[会话展示组件](#50920)

## 五、常见问题
1.会话内容存档第三方接口和企业内部接口的区别是什么？
**答：**1）调用主体差异：第三方接口的调用主体是第三方服务商，企业内部接口的调用主体是企业；2）接口实现差异：第三方接口不对外输出会话内容，服务商可通过会话展示组件展示会话内容，并使用配套分析接口进行内容分析，以实现相关产品功能。

2.会话内容存档第三方接口是否需要购买，如何购买？
**答：**会话内容存档第三方接口为服务商付费购买的增值接口，接口单独定价，详情请查看[收费方案](https://developer.work.weixin.qq.com/document/path/99697) 。

3.会话内容存档企业内部接口的购买是否有调整？
**答：**暂无调整。

4.会话内容存档企业内部接口的调用是否有调整？
**答：**暂无调整。会话内容存档企业内部接口定位是企业主体调用，对于服务商应以第三方主体调用第三方接口。

5.调用会话内容存档第三方接口，与使用会话展示组件是同一个应用吗？
**答：**不是同一个应用。调用会话内容存档第三方接口需要使用“会话内容存档接口授权”进行调用，而会话展示组件需要使用第三方应用或代开发应用进行调用。

6.企业取消授权会话内容存档接口授权，再重新授权，在会话组件里还能展示原来的消息吗？
**答：**企业取消授权之后，存档的消息就会自动清除，故重新授权之后也不能再展示原来存档的消息。

如有其他问题，可咨询企业微信产品客服。
