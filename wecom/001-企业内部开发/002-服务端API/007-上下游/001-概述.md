---
title: "概述"
doc_id: 42599
category_id: 97213
source_url: https://developer.work.weixin.qq.com/document/path/97213
---
最后更新：2025/11/11

[TOC]

---

# 「上下游」是什么？
「上下游」是企业微信针对企业间协作场景推出的解决方案。
企业可使用此功能，与自己的经销商、供应商、合作伙伴便捷沟通、共享应用，实现高效业务协同。

# 如何创建、使用「上下游」？
1. 打开企业微信手机客户端-工作台，找到「上下游」应用；
2. 创建一个上下游；
3. 点击「邀请上下游联系人」，发送邀请链接给本企业的经销商、供应商、合作伙伴联系人；
4. 对方确认后，即可在通讯录中找到对方并发起沟通。
- ![](https://wework.qpic.cn/wwpic/592373_S0gz37qlS12DKN9_1637204174/0)

注意：
> * 客户端需升级到 3.1.20 以上版本
> * 行业为「教育-学前教育、初中等教育、教育行政单位」的企业成员，以及团队形态的成员暂不支持创建和加入上下游

# 如何共享应用？
1. 打开企业微信手机客户端-工作台，找到「上下游」应用
2. 点开一个本企业创建的上下游
3. 点击「设置共享应用」
4. 选择需共享的应用、设置共享范围，完成共享
5. 上下游企业成员可在企微客户端-工作台查看和使用被共享的应用
- ![](https://wework.qpic.cn/wwpic/29173**WMog_MiTDmd1cy_1637322672/0)

# 共享应用在上下游场景下可以做什么？
1. **跨企业获取信息**
 1. 上下游信息
 1. 上下游联系人信息
 1. 上下游联系人添加的客户信息（可跨企业打通客户数据）
1. **跨企业业务协同**
 1. 群发通知（应用消息）
 1. 打开/创建上下游会话（单聊、群聊）
 1. 客户管理
 1. 设置群发任务（单聊、群聊、朋友圈）
 1. 打开/创建客户会话（单聊、群聊）
 1. 在职、离职继承
 1. 客户联系统计
 1. 日程、会议、直播、审批、紧急通知等系统功能均支持跨企业调用

# 开发者如何适配？
## 概述
1. 上下游共享应用成功，有回调事件
2. 获取下游企业 corpid、应用 id
3. 获取应用使用者信息
4. ISV/上游企业支持以下游企业身份调用 API
5. 通讯录、客户联系的回调，都回调给上级企业

## 详述
### 1、应用共享成功回调
上游企业将应用共享给下游企业后，需使用特定接口获取下游应用的身份和权限，才能控制下游应用，因此需开发者做一定的适配。
- 自建应用，上游企业共享给下游企业后，企业微信会回调[应用共享事件](#12974/上下游共享应用事件回调)给上游企业。
上游企业收到回调事件后，可通过相应的API接口进行业务开发。
需特别注意，企业微信账号ID安全性已全面升级，上游企业获取到下游企业的账号ID规则与第三方服务商获取到的账号ID规则是一样的，详情可以参考[企业微信账号ID安全性全面升级](#35863)。
- 第三方应用，上游企业共享给下游企业后，企业微信会为每个下游企业分别安装授权该第三方应用，并[回调授权通知](#14951)给第三方，所以相当于是多了一种授权安装的渠道。
不同的是，该情况下企业微信还会[回调共享应用事件](#25681)给第三方应用，之后第三方应用可[获取应用共享信息](#25951)，以及[获取下游企业付费版本信息](#25575)。

下面简要说明需要注意的地方。

### 2、获取应用共享信息
上游企业共享应用给下游企业后，会收到共享应用事件回调，此时上游企业需要通过接口：[获取应用共享信息](#25951)，获得下游已授权企业的corpid和应用id列表，并保存起来，后面调接口需要用到。

### 3、获取应用使用者信息
因为应用可以共享给多个下游企业，所以上游企业调用接口前，需要得知当前使用者到底属于哪个企业。
见[身份验证](#15232)相关接口。与普通应用使用方法的不同点在于：
- 自建应用[构造网页授权链接](#15048)时，参数```appid```填**上游企业**的corpid （第三方应用无变化，参见[构造第三方应用oauth2链接](#15121)）
- 自建应用[获取访问用户身份](#15047)接口，在「上下游」场景，返回的UserId格式如：CorpId/userid，分解即可得到下游企业的corpid（第三方应用无变化，参见[第三方获取访问用户身份](#15122)）

### 4、调用接口
#### 使用API接口
- 第三方应用。不同点在于：[获取企业永久授权码](#14942)接口不返回安装的管理员信息。
- 自建应用。不同点在于：需要换取下游企业的access_token来调接口，实现与下游应用交互
- ![](https://wework.qpic.cn/wwpic/340887_s5bMX4t7RLCD54c_1637234079/0)
 ① [获取上游企业access_token](#15074)
 ② [获取下游企业access_token](#24919)
 ③ 使用第②步骤得到的**下游企业**的access_token调用各种API接口。例如通过调用[获取应用](#10087)接口获取下游应用的可见范围，通过调用[读取成员](#10019)接口获取获取下游企业成员详情，通过调用[创建企业群发](#15836)接口给下游企业客户群发消息。

#### 使用JSAPI接口
- 第三方应用。无变化
- 自建应用。与[普通企业使用JSAPI](#14931)不同点在于：需要使用下游企业 jsapi_ticket 来进行jsapi签名，并用下游企业的身份调用agentConfig
- ![](https://wework.qpic.cn/wwpic/397172_04xI_DImRlKgBPQ_1641560627/0)
 ① [获取上游企业access_token](#15074)
 ② [获取下游企业的access_token](#24919)
 ③ [获取jsapi_ticket并签名](#14924)。**特别注意**，需要使用第②步骤得到的**下游企业**的access_token获取jsapi_ticket
 ④ [agentConfig](#14931)。**特别注意**，此时```appId```和```agentId```参数，需要填**下游企业**的corpid和应用id。

#### 使用小程序接口
- 第三方应用。无变化，通过[永久授权码获取企业access_token](#14944)。
- 自建应用。与普通企业[小程序登录流程](#16055)的不同点在于：需要使用[获取下游企业的小程序session](#25574)来转为下游企业的登录session
- ![](https://wework.qpic.cn/wwpic/27777_b1ce8JTJRR2k75w_1641458685/0)
 ① [获取上游企业access_token](#15074)
 ② [获取上游sessionkey](#16056)
 ③ [获取下游企业的access_token](#24919)
 ④ [换取下游企业的sessionkey](#25574)

### 5、上下游的回调事件
上下游应用统一由上游企业管理，**所以下游企业的应用事件、应用消息均回调给上游企业**。请注意以下几点：
- [**应用事件回调**](#12974)（包括通讯录变更事件、客户联系变更事件等）
 - 第三方应用无变化；
 - 对于自建应用，**所有下游企业的用户产生的应用事件，均回调给上游企业的回调URL，而事件里的企业信息是下游企业的信息。**
 - 例如[成员关注及取消关注事件](#12974/成员关注及取消关注事件)：
 ```
 <xml>
 <ToUserName><
- ![CDATA[toUser]]></ToUserName>
 <FromUserName><
- ![CDATA[UserID]]></FromUserName>
 <CreateTime>1348831860</CreateTime>
 <MsgType><
- ![CDATA[event]]></MsgType>
 <Event><
- ![CDATA[subscribe]]></Event>
 <AgentID>1</AgentID>
 </xml>```
 事件中```ToUserName```是**下游**企业corpid，```FromUserName```是**下游**企业的密文userid

- **共享应用事件（本次新增）**
 - 当应用分享或解除分享后，会触发该事件给上游企业或第三方服务商。收到该事件后，需要调用[获取应用共享信息](#25951)更新应用的分享列表并存储。
 - [第三方应用共享应用事件回调](#25681/上下游共享应用事件回调)。当上游企业管理员在管理端分享(或解除分享)应用给下游企业后（若需要敏感权限需下游企业确认），会推送该事件给服务商。
 - [自建应用共享应用事件回调](#12974/上下游共享应用事件回调)。当上游企业管理员在管理端分享(或解除分享)应用给下游企业后（若需要敏感权限需下游企业确认），会推送该事件给上游企业。

- [版本变更事件](#18271)
 - 对于付费购买的第三方应用，上游企业付费等行为产生应用版本变更后，所有下游企业均会产生版本变更事件给服务商

- [消息回调](#12973)
 - 第三方应用无变化；
 - 对于自建应用，**所有下游企业的回调消息均推送给上游企业的回调URL，而消息里面的企业信息是下游企业的信息。**

# 配置可调用接口的应用
管理员进入企业微信管理后台后点击“客户与上下游”-“上下游”页面，点开“API”小按钮，在“可调用接口的应用”中选择自建应用，配置后该应用才可以调用上下游的接口。仅可配置一个应用
- ![enter image description here](https://wework.qpic.cn/wwpic3az/790381_vIGJlR6sT4GGxNi_1701240678/0)
